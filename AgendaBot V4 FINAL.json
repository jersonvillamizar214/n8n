{
  "name": "AgendaBot V4",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "776585cf-a377-4e2a-a300-136eb203f25d",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -105376,
        159408
      ],
      "webhookId": "d1e7877b-4151-4aff-9c3a-0bf8cdd950cd",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "telegram_user",
              "name": "telegram_user",
              "value": "={{ String($json.message.from.id) }}",
              "type": "string"
            },
            {
              "id": "username",
              "name": "username",
              "value": "={{ $json.message.from.first_name || $json.message.from.username || 'Usuario' }}",
              "type": "string"
            },
            {
              "id": "mensaje",
              "name": "mensaje",
              "value": "={{ ($json.message.text || '').trim() }}",
              "type": "string"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "value": "={{ String($json.message.chat.id) }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "d8d5cc80-eb1b-41b6-afcc-33c2ec6d2743",
      "name": "Set Variables",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -105152,
        159408
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit?usp=drivesdk",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "SESSIONS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "=telegram_user",
              "lookupValue": "={{ $json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "id": "42ac2f9f-cca9-41f1-8147-de672f7fc2c2",
      "name": "Get Session",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -104928,
        159408
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "session-exists",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d595ae29-cf86-4552-95c0-8acf4d48dff5",
      "name": "Session Exists?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -104704,
        159408
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "telegram_user",
              "name": "telegram_user",
              "value": "={{ $('Set Variables').item.json.telegram_user }}",
              "type": "string"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "value": "={{ $('Set Variables').item.json.chat_id }}",
              "type": "string"
            },
            {
              "id": "mensaje",
              "name": "mensaje",
              "value": "={{ $('Set Variables').item.json.mensaje }}",
              "type": "string"
            },
            {
              "id": "username",
              "name": "username",
              "value": "={{ $('Set Variables').item.json.username }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "timestamp",
              "value": "={{ $('Set Variables').item.json.timestamp }}",
              "type": "string"
            },
            {
              "id": "pantalla_actual",
              "name": "pantalla_actual",
              "value": "={{ $json.pantalla_actual || 'menu_principal' }}",
              "type": "string"
            },
            {
              "id": "paso_actual",
              "name": "paso_actual",
              "value": "={{ $json.paso_actual || '0' }}",
              "type": "string"
            },
            {
              "id": "datos_parciales",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales || '{}' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "0b1d5912-76c5-48c1-ad11-15e9e5488e74",
      "name": "Merge Session Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -104256,
        159264
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "telegram_user",
              "name": "telegram_user",
              "value": "={{ $('Set Variables').item.json.telegram_user }}",
              "type": "string"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "value": "={{ $('Set Variables').item.json.chat_id }}",
              "type": "string"
            },
            {
              "id": "mensaje",
              "name": "mensaje",
              "value": "={{ $('Set Variables').item.json.mensaje }}",
              "type": "string"
            },
            {
              "id": "username",
              "name": "username",
              "value": "={{ $('Set Variables').item.json.username }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "timestamp",
              "value": "={{ $('Set Variables').item.json.timestamp }}",
              "type": "string"
            },
            {
              "id": "pantalla_actual",
              "name": "pantalla_actual",
              "value": "nuevo_usuario",
              "type": "string"
            },
            {
              "id": "paso_actual",
              "name": "paso_actual",
              "value": "0",
              "type": "string"
            },
            {
              "id": "datos_parciales",
              "name": "datos_parciales",
              "value": "{}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "90bba0ea-dbe2-4963-af3f-560adf085d9f",
      "name": "Set New User Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -104480,
        159504
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 319260215,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hotrf-91CoJyrer3T8fgQzWAZaC6NZn-FfVSDZtKUn8/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.telegram_user }}",
            "pantalla_actual": "={{ $json.pantalla_actual }}",
            "paso_actual": "={{ $json.paso_actual }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $json.timestamp }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "ba14b86c-20e3-4d25-a6d9-8961f66be98b",
      "name": "Create New Session",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -104256,
        159504
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2000502643,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hotrf-91CoJyrer3T8fgQzWAZaC6NZn-FfVSDZtKUn8/edit#gid=2000502643"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $json.timestamp }}",
            "telegram_user": "={{ $json.telegram_user }}",
            "pantalla": "={{ $json.pantalla_actual }}",
            "opcion_elegida": "={{ $json.mensaje }}",
            "resultado": "procesando"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "67f01044-e6ac-46fa-80e2-984027095eb7",
      "name": "Log Interaction",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -104032,
        159312
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "=Hola {{ $json.username }}, soy AgendaBot ðŸ‘‹\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el nÃºmero de la opciÃ³n que quieras usar.\n\nMenÃº principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. HÃ¡bitos\n5. Listas\n6. Reportes\n\nðŸ’¡ Tip: escribe solo el nÃºmero (ej: 1) y presiona enviar.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e112dc4c-d2d3-411b-88a2-d27fb06d6e54",
      "name": "Send Bienvenida",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103584,
        153216
      ],
      "webhookId": "40628ee4-c0d7-41e8-868a-6714b571035a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 319260215,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hotrf-91CoJyrer3T8fgQzWAZaC6NZn-FfVSDZtKUn8/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "216714aa-13dc-4bca-8f45-1c68d462a749",
      "name": "Update Session to Menu",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        153216
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fcf71e05-8000-4cf2-bc68-c48b3f232755",
              "name": "=telegram_user",
              "value": "={{ $('Set Variables').item.json.telegram_user }}",
              "type": "string"
            },
            {
              "id": "78e868ab-851a-4b9c-81a6-79cfb640560d",
              "name": "timestamp",
              "value": "={{ $('Set Variables').item.json.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103360,
        153216
      ],
      "id": "31037857-f762-405a-b423-499c50c2b7c1",
      "name": "Prepare Update Data"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "nuevo_usuario",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "78ae880b-7907-4375-ba18-175e41ba057f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "bienvenida"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "reset",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  },
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "or"
              },
              "renameOutput": true,
              "outputKey": "inicio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "menu_principal",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "46d39ddb-d57d-49de-83d0-2b2de8613b20"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "menu_principal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8efa232e-9513-44cf-85d5-516eebcc9339"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    },
                    "id": "1eeaf8e8-f782-4d21-a504-88d6049dc594"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_wizard"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tareas_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "68f4f53e-5398-4e8b-8df7-e751e9e4a927"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tareas_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_crear_paso",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    },
                    "id": "tarea-wizard-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarea_wizard"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habitos_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c94dec9f-13e2-4ff4-b4eb-e0c7a9eacdbb"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habitos_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "listas_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "acfd0fd7-8ca3-4e8c-9532-9feb7dfe9e99"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "listas_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "recordatorios_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "eba92eb3-0f47-4ef0-82c4-4e7d1a276cc6"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "recordatorios_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "reportes_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f9f5b1cf-eeed-4f59-a238-687aea491b5d"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reportes_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "config_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "cb04c32b-2d72-48bc-8df1-bfcf70f52e9b"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "config_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "admin_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ff5f693e-9967-489c-935a-2c4ef27a74ff"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "admin_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "ayuda_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ayuda-menu-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ayuda_menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_repro_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_repro_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_repro_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_repro_2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_cancel_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_cancel_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_completar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda_completar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "consultar_citas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "consultar_citas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "ver_tareas_pendientes",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver_tareas_pendientes"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "ver_tareas_completadas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver_tareas_completadas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_completar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarea_completar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_completada_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarea_completada_confirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_eliminar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarea_eliminar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_eliminada_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarea_eliminada_confirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "ver_habitos",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver_habitos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habito_eliminar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habito_eliminar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habito_eliminado_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habito_eliminado_confirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habito_crear_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habito_crear_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habito_crear_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habito_crear_2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "habito_crear_3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habito_crear_3"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "recordatorio_editar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "recordatorio_editar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "recordatorio_editar_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "recordatorio_editar_2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "lista_crear_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "lista_crear_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "lista_crear_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "lista_crear_2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "ver_listas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver_listas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "items_lista",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "items_lista"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "items_agregar",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "items_agregar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "items_completar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "items_completar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "items_eliminar_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "items_eliminar_1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "reporte_dia",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reporte_dia"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "reporte_semanal",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reporte_semanal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "reporte_productividad",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reporte_productividad"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "config_cambiar_nombre",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "config-cambiar-nombre-rule"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "config_cambiar_nombre"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "243ac92c-0fbf-4ba7-8a63-4b6e390d6ac1",
      "name": "Router Principal",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103808,
        158624
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "0",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ayuda"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agenda"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tareas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "recordatorios"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "habitos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "listas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "6",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reportes"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "7",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "config"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "8",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "admin"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "f69d6def-a60b-423a-b69f-630d402f851a",
      "name": "Menu Principal Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        160496
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "AYUDA - AgendaBot\n\nAgenda: Gestiona citas\nTareas: Pendientes\nRecordatorios: No olvides nada\nHabitos: Rutinas\nListas: Organiza items\nReportes: Resumen\n\n9. Volver al menu",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "a9ea7122-03e7-4216-8b2d-f9b5ac223d2e",
      "name": "Send Ayuda",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        160024
      ],
      "webhookId": "2c99b8a0-e5e8-4668-9000-345f26006eb3",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "AGENDA\n\n1. Agendar cita\n2. Consultar agenda\n3. Reprogramar\n4. Cancelar\n5. Completar\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f2dccb89-6e00-4d73-92b9-ffa058b59891",
      "name": "Send Agenda Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        160216
      ],
      "webhookId": "b638330f-35a7-4398-806e-7fc06d94f707",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}",
            "row_number": 0
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "68288e22-3396-434b-ac16-ba60265b849d",
      "name": "Update to Agenda Menu",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        160216
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "TAREAS\n\n1. Crear tarea\n2. Ver pendientes\n3. Ver completadas\n4. Completar\n5. Eliminar\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5148526a-d0d4-4363-80c4-773b48747663",
      "name": "Send Tareas Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        165840
      ],
      "webhookId": "4700a0c5-c904-4103-8d94-d4e046dee0d7",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "tareas_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "fee083f1-a85d-4823-b8fd-e3fd2d7c13c3",
      "name": "Update to Tareas Menu",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        165840
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "HABITOS\n\n1. Crear habito\n2. Ver habitos\n3. Eliminar\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "a92a106f-c545-47f5-8a34-aed208605e8b",
      "name": "Send Habitos Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        153744
      ],
      "webhookId": "dc65c4be-26df-48bd-ba1e-84086a142a8b",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "habitos_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "69b714b3-35c7-431d-ab0d-d335c3a75a4d",
      "name": "Update to Habitos",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        153744
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "crear"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "eliminar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "51903b9e-3563-4184-a786-5df9aa602fbf",
      "name": "Habitos Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        155712
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Escribe el nombre del habito:\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "56bb725a-7399-44d9-9f30-e8ef7575413c",
      "name": "Send Habito Paso 1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        162456
      ],
      "webhookId": "910bda63-2c18-4683-b92d-4f9257a00bec",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "habito_crear_1",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "2f082034-348b-458e-8c84-0fb84823a582",
      "name": "Update Habito Paso 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        162456
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "estado",
              "lookupValue": "activo"
            }
          ]
        },
        "options": {}
      },
      "id": "dea8d766-3d3d-461b-9fa3-6074eab5f9a3",
      "name": "Get Habitos Activos",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101792,
        162648
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.nombre) {\n  return [{json:{mensaje:'HABITOS:\\n\\nNo tienes habitos activos.\\n\\n9. Volver'}}];\n}\nlet t = 'HABITOS ACTIVOS:\\n\\n';\nfor (let i = 0; i < items.length; i++) {\n  const freq = items[i].json.frecuencia ? ' - ' + items[i].json.frecuencia : '';\n  const hora = items[i].json.hora_recordatorio ? ' - ' + items[i].json.hora_recordatorio : '';\n  t += (i+1)+'. '+items[i].json.nombre + freq + hora + '\\n';\n}\nreturn [{json:{mensaje:t+'\\n9. Volver'}}];"
      },
      "id": "4a483e2c-e31b-41ad-81e3-9d22eea0de02",
      "name": "Format Habitos Activos",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -101568,
        162648
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2867c131-4055-413e-ac3f-50f9ecdc6a96",
      "name": "Send Habitos Activos",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101344,
        162648
      ],
      "webhookId": "ecb062d1-d677-4cb0-9e40-a23d41f6829c",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "ver_habitos",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "3ab0eaee-2825-484f-ab99-891df05fa908",
      "name": "Update Session Ver Habitos",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101120,
        162648
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "670fdc67-4052-4ea7-9845-7f6876832fc4",
      "name": "Ver Habitos Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103136,
        155376
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "26e0ceed-7b33-4ca2-b10b-1bac3341d094",
      "name": "Send Invalid Ver Habitos",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        155424
      ],
      "webhookId": "bbbdbb4b-0ebe-4514-afad-d71221df44f1",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "estado",
              "lookupValue": "activo"
            }
          ]
        },
        "options": {}
      },
      "id": "e130eac6-b7f6-413a-b81c-8188f0cb0204",
      "name": "Get Habitos Para Eliminar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101792,
        163920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.nombre) {\n  return [{json:{mensaje:'ELIMINAR HABITO:\\n\\nNo tienes habitos activos.\\n\\n9. Volver', list: []}}];\n}\nlet t = 'ELIMINAR HABITO:\\n\\nSelecciona el numero del habito a eliminar:\\n\\n';\nconst list = [];\nfor (let i = 0; i < items.length; i++) {\n  t += (i+1)+'. '+items[i].json.nombre + '\\n';\n  list.push({index: i+1, id_habito: items[i].json.id_habito, nombre: items[i].json.nombre});\n}\nreturn [{json:{mensaje:t+'\\n9. Volver', list: list}}];"
      },
      "id": "fdef8d1b-03d3-41ab-97d6-41a449fbcfb5",
      "name": "Format Lista Eliminar Habitos",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -101568,
        163920
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d77378bc-1fe5-4169-972b-af792adab108",
      "name": "Send Lista Eliminar Habitos",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101344,
        163920
      ],
      "webhookId": "0ab9fab1-e09b-4e30-b2f9-bb971945e179",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "habito_eliminar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Eliminar Habitos').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8c2192ee-e509-4f0d-8105-cc6f02bb7bbe",
      "name": "Update Session Eliminar Habito",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101120,
        163920
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nconst listJson = $('Merge Session Data').first().json.datos_parciales || '[]';\nlet list = [];\ntry { list = JSON.parse(listJson); if (!Array.isArray(list)) list = []; } catch(e) { list = []; }\n\nif (mensaje === '9') { return [{json: {valid: false, cancel: true}}]; }\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length || !list[index - 1]) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida. Escribe el numero o 9 para volver.'}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_habito: selected.id_habito, nombre: selected.nombre}}];"
      },
      "id": "877c711a-cf98-4e82-9858-3eea241ace43",
      "name": "Logic Seleccion Eliminar Habito",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        156696
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "7d96a682-ae04-4f95-bb0e-f6fcffde33c3",
      "name": "If Valid Eliminar Habito",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        156696
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_habito": "={{ $json.id_habito }}",
            "estado": "eliminado"
          },
          "matchingColumns": [
            "id_habito"
          ]
        },
        "options": {}
      },
      "id": "6c99d9f3-e3c7-4999-9ae9-315d41c433ea",
      "name": "Update Habito Eliminado",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        156600
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=ðŸ—‘ï¸ Habito eliminado: {{ $('Logic Seleccion Eliminar Habito').first().json.nombre }}\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "68849beb-1657-4035-808f-732e0c0d23ed",
      "name": "Send Habito Eliminado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        156600
      ],
      "webhookId": "81638b66-227b-4881-ab74-a5cd0296f95b",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "db30fd2e-1bd4-47c9-b7c8-784a65731928",
      "name": "If Cancel Eliminar Habito",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        156792
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Eliminar Habito').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "7d73e80e-a87f-44c8-9382-d1c5e4476ea9",
      "name": "Send Error Eliminar Habito",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        156888
      ],
      "webhookId": "88f2a318-2211-474c-b857-40adabc6ef12",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "habito_eliminado_confirm",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "62e9975f-d8b7-4e1a-a345-d2b2e4a1df81",
      "name": "Update Session Habito Eliminado",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        156600
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "b13795e1-c6a8-4d1f-b328-ab06fe92a499",
      "name": "Habito Eliminado Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103136,
        155928
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8fbed36a-e572-440a-b631-c3c131275d5b",
      "name": "Send Invalid Habito Eliminado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        155976
      ],
      "webhookId": "f8f22735-3d4e-42d7-ae76-deff01f02079",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Opcion no valida en Habitos. Presiona 9 para volver.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6b5e040d-d6c1-4a25-bc44-9a2afe9b79c7",
      "name": "Send Invalid Habitos",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        164112
      ],
      "webhookId": "881e1c44-ef60-48ce-a3b7-202a8fb1bd60",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nif (mensaje === '9') { return [{json: {cancel: true}}]; }\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\ndatos.nombre = mensaje;\nreturn [{json: {cancel: false, datos_parciales: JSON.stringify(datos)}}];"
      },
      "id": "bbd11fe2-8b06-4001-b170-becd33c893b2",
      "name": "Habito Crear Paso 2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        154224
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f5ef8caa-437d-492f-9828-37dd764fb80d",
      "name": "If Cancel Crear Habito",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        154224
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Selecciona la frecuencia:\n\n1. Diario\n2. Semanal\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "9bb5b54b-7a0a-48cc-89e6-8fbf9ccf0c55",
      "name": "Send Habito Paso 2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        154296
      ],
      "webhookId": "a775d0a2-d2d9-4bb9-aa04-7c953c38057c",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "habito_crear_2",
            "paso_actual": "2",
            "datos_parciales": "={{ $('Habito Crear Paso 2').first().json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "254bc116-8861-4f00-b4ae-fd0a234909a2",
      "name": "Update Habito Paso 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        154296
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nif (mensaje === '9') { return [{json: {cancel: true}}]; }\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nif (mensaje === '1') datos.frecuencia = 'diario';\nelse if (mensaje === '2') datos.frecuencia = 'semanal';\nelse { return [{json: {cancel: false, error: true}}]; }\nreturn [{json: {cancel: false, error: false, datos_parciales: JSON.stringify(datos)}}];"
      },
      "id": "d4080a47-7e2b-49e1-9f79-72946b84d188",
      "name": "Habito Crear Paso 3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        153552
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "754ea50a-710d-4bad-ba17-dcff8ef617c2",
      "name": "If Cancel Crear Habito 2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        153552
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Escribe la hora del recordatorio (ej: 08:00):\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e348489b-d5ac-4a39-b221-2b4b1b73d4c3",
      "name": "Send Habito Paso 3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        153552
      ],
      "webhookId": "2c22256c-a74b-4ec0-9923-c0733fceb956",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "habito_crear_3",
            "paso_actual": "3",
            "datos_parciales": "={{ $('Habito Crear Paso 3').first().json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8c7e53a4-bddb-41da-8262-1311cb05964f",
      "name": "Update Habito Paso 3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        153552
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nif (mensaje === '9') { return [{json: {cancel: true}}]; }\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\ndatos.hora_recordatorio = mensaje;\nconst id_habito = 'HAB-' + Date.now();\nreturn [{json: {cancel: false, id_habito: id_habito, nombre: datos.nombre, frecuencia: datos.frecuencia, hora_recordatorio: datos.hora_recordatorio, estado: 'activo'}}];"
      },
      "id": "480655c0-361c-42f9-9120-d9039d93372a",
      "name": "Guardar Habito",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        153840
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "1227b2ba-e9ee-4481-8564-2993097dd074",
      "name": "If Cancel Crear Habito 3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        153840
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_habito": "={{ $json.id_habito }}",
            "nombre": "={{ $json.nombre }}",
            "frecuencia": "={{ $json.frecuencia }}",
            "hora_recordatorio": "={{ $json.hora_recordatorio }}",
            "estado": "={{ $json.estado }}",
            "creado_por": "={{ $('Set Variables').first().json.telegram_user }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_habito",
              "displayName": "id_habito",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_recordatorio",
              "displayName": "hora_recordatorio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "a0106921-c069-4bb1-a4ad-9c7c24717582",
      "name": "Insert Habito",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        153936
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Habito creado: {{ $('Guardar Habito').first().json.nombre }}\nFrecuencia: {{ $('Guardar Habito').first().json.frecuencia }}\nRecordatorio: {{ $('Guardar Habito').first().json.hora_recordatorio }}\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e4257a23-c85c-4195-952f-50d6acf81fae",
      "name": "Send Habito Creado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        153936
      ],
      "webhookId": "b72c3018-aaf2-474c-9428-4f86dbd8c07a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "estado",
              "lookupValue": "activo"
            }
          ]
        },
        "options": {}
      },
      "id": "7688ff1b-cfbb-4e70-b2fd-d9abe3c244be",
      "name": "Get Habitos Recordatorio",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        160408
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.nombre) {\n  return [{json:{mensaje:'RECORDATORIOS:\\n\\nNo tienes habitos para configurar.\\n\\n9. Volver', list: []}}];\n}\nlet t = 'RECORDATORIOS:\\n\\nSelecciona un habito para cambiar su hora:\\n\\n';\nconst list = [];\nfor (let i = 0; i < items.length; i++) {\n  const hora = items[i].json.hora_recordatorio || 'sin hora';\n  t += (i+1)+'. '+items[i].json.nombre + ' - ' + hora + '\\n';\n  list.push({index: i+1, id_habito: items[i].json.id_habito, nombre: items[i].json.nombre});\n}\nreturn [{json:{mensaje:t+'\\n9. Volver', list: list}}];"
      },
      "id": "161dd1bc-ff0f-41d6-8b40-9163b23e51f1",
      "name": "Format Lista Recordatorios",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102912,
        160408
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "862b9898-68c2-442e-80db-8c3dbd620c68",
      "name": "Send Lista Recordatorios",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        160408
      ],
      "webhookId": "3aebe909-632f-4f84-b2e6-a7fb78b76d80",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "recordatorio_editar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Recordatorios').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "72203359-3b66-4fd5-b017-99bbd0d61a97",
      "name": "Update Session Recordatorio",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        160408
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nconst listJson = $('Merge Session Data').first().json.datos_parciales || '[]';\nlet list = [];\ntry { list = JSON.parse(listJson); if (!Array.isArray(list)) list = []; } catch(e) { list = []; }\n\nif (mensaje === '9') { return [{json: {valid: false, cancel: true}}]; }\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length || !list[index - 1]) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida.'}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_habito: selected.id_habito, nombre: selected.nombre}}];"
      },
      "id": "2d9f3184-cd23-49ac-9648-d6b1a5e4a000",
      "name": "Logic Seleccion Recordatorio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102464,
        154080
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e7533961-8b4c-4e19-bbc0-266db9a31f1b",
      "name": "If Valid Recordatorio",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102240,
        154080
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=Escribe la nueva hora para {{ $json.nombre }} (ej: 08:00):\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "b79af6d3-6cd1-43bb-9a17-67c2dc639016",
      "name": "Send Pedir Hora",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102016,
        153984
      ],
      "webhookId": "90438c68-03aa-49d5-b2e4-0f6701d430a9",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "recordatorio_editar_2",
            "paso_actual": "2",
            "datos_parciales": "={{ JSON.stringify({id_habito: $('Logic Seleccion Recordatorio').first().json.id_habito, nombre: $('Logic Seleccion Recordatorio').first().json.nombre}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "dbd3845f-c73d-41cc-9127-691083918077",
      "name": "Update Session Recordatorio 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101792,
        161496
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "854107c8-ddb4-4653-916b-d1e48ffb5486",
      "name": "If Cancel Recordatorio",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102016,
        154296
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Recordatorio').first().json.error }}\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f9d1704f-9040-4a13-a7d7-2549ed8ec447",
      "name": "Send Error Recordatorio",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        161856
      ],
      "webhookId": "d9c8c689-5fa1-4c1d-a99e-5172aebf9ee7",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nif (mensaje === '9') { return [{json: {cancel: true}}]; }\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nreturn [{json: {cancel: false, id_habito: datos.id_habito, nombre: datos.nombre, hora_recordatorio: mensaje}}];"
      },
      "id": "db1154c0-f480-47a3-850a-c878d1aadc8c",
      "name": "Guardar Hora Recordatorio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102688,
        153360
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3eaabfa8-1fbe-4ffc-bdd5-5a670e85e825",
      "name": "If Cancel Guardar Hora",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102464,
        153360
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_habito": "={{ $json.id_habito }}",
            "hora_recordatorio": "={{ $json.hora_recordatorio }}"
          },
          "matchingColumns": [
            "id_habito"
          ]
        },
        "options": {}
      },
      "id": "dfc194fe-8578-4fac-937e-38b3a9f701a0",
      "name": "Update Hora Habito",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102240,
        153288
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Hora actualizada para {{ $('Guardar Hora Recordatorio').first().json.nombre }}: {{ $('Guardar Hora Recordatorio').first().json.hora_recordatorio }}\n\nVolviendo al menÃº",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "aa545970-da73-40a3-87ba-1e99d24131c8",
      "name": "Send Hora Actualizada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102016,
        153288
      ],
      "webhookId": "3791f4be-d63f-40f5-8160-5ea276489b65",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "LISTAS\n\n1. Crear lista\n2. Ver mis listas\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6af4fdd8-ea0b-4b4d-8da7-f268a5888e46",
      "name": "Send Listas Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        154872
      ],
      "webhookId": "c046e4ab-d9dc-4590-ac6d-6e8cfb6797c0",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "listas_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "6e110f08-8551-4458-825a-2d8c1a3da310",
      "name": "Update to Listas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        154872
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "crear"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "e1621087-6a53-47c8-8237-5364eb2675aa",
      "name": "Listas Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        158392
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "CREAR LISTA\n\nEscribe el nombre de la lista:\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "9fc5d332-6b5c-49e9-ab90-d12941ad3d68",
      "name": "Send Lista Paso 1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        158424
      ],
      "webhookId": "82876878-351a-4ba5-8717-7f29c01d4707",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "lista_crear_1",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "a2d5c091-4c65-47ec-89fc-9952ccc08733",
      "name": "Update Lista Paso 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        158424
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nif (mensaje === '9') { return [{json: {cancel: true}}]; }\nconst id_lista = 'LIST-' + Date.now();\nreturn [{json: {cancel: false, id_lista: id_lista, nombre_lista: mensaje, items_count: 0}}];"
      },
      "id": "79252c59-fe6e-4cf1-a920-f86bf905159a",
      "name": "Lista Crear Nombre",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        155568
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fcd89a1e-c1d9-492e-9e43-505d41bf3899",
      "name": "If Cancel Lista 1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        155568
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 704259980,
          "cachedResultName": "LISTAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_lista": "={{ $json.id_lista }}",
            "nombre_lista": "={{ $json.nombre_lista }}",
            "tipo": "general",
            "creado_por": "={{ $('Set Variables').first().json.telegram_user }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre_lista",
              "displayName": "nombre_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo",
              "displayName": "tipo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "3e443243-8592-4f50-8179-b8fa5ac7760c",
      "name": "Insert Lista",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        155616
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=Lista \"{{ $('Lista Crear Nombre').first().json.nombre_lista }}\" creada.\n\nEscribe un item para agregar:\n\n0. Terminar\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "03df1cd7-99db-4edb-bbf4-3779454bb83b",
      "name": "Send Lista Paso 2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        155616
      ],
      "webhookId": "4dc0043c-a2d6-492f-80b3-b556c61f5eb7",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "lista_crear_2",
            "paso_actual": "2",
            "datos_parciales": "={{ JSON.stringify({id_lista: $('Lista Crear Nombre').first().json.id_lista, nombre_lista: $('Lista Crear Nombre').first().json.nombre_lista, items_count: $('Lista Crear Nombre').first().json.items_count}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "a3e52357-0d83-4926-9dc1-6b26a11f3f40",
      "name": "Update Lista Paso 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        155616
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\n\nif (mensaje === '9') { return [{json: {action: 'cancel'}}]; }\nif (mensaje === '0') { return [{json: {action: 'terminar', nombre_lista: datos.nombre_lista, items_count: datos.items_count || 0}}]; }\n\nconst id_item = 'ITEM-' + Date.now();\nreturn [{json: {action: 'agregar', id_item: id_item, id_lista: datos.id_lista, item: mensaje, nombre_lista: datos.nombre_lista, items_count: (datos.items_count || 0) + 1}}];"
      },
      "id": "14f4bdb4-d14e-4d1d-96b8-82b7f253b80f",
      "name": "Lista Agregar Item",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        154608
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "agregar",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agregar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "terminar",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "terminar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "cancel",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancel"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "id": "b721a130-ebda-40a0-b031-be6d0d5f2190",
      "name": "Lista Action Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103136,
        154592
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 913068970,
          "cachedResultName": "ITEMS_LISTA"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "={{ $json.id_item }}",
            "id_lista": "={{ $json.id_lista }}",
            "item": "={{ $json.item }}",
            "estado": "pendiente"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "c83e8513-13aa-4fdc-ad04-c0422c3b932a",
      "name": "Insert Item Lista",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        154488
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ“ Item agregado: {{ $('Lista Agregar Item').first().json.item }}\n\nEscribe otro item:\n\n0. Terminar\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "113c696c-e1ec-4ae7-bccb-9344b18bca78",
      "name": "Send Item Agregado Loop",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        154488
      ],
      "webhookId": "a1593d02-70dd-45a0-9a8d-2dc0d8a2f6ac",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "lista_crear_2",
            "paso_actual": "2",
            "datos_parciales": "={{ JSON.stringify({id_lista: $('Lista Agregar Item').first().json.id_lista, nombre_lista: $('Lista Agregar Item').first().json.nombre_lista, items_count: $('Lista Agregar Item').first().json.items_count}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8cb0f047-e23b-4117-91c3-9a63920d2f3b",
      "name": "Update Session Item Loop",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        154488
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Lista \"{{ $json.nombre_lista }}\" creada con {{ $json.items_count }} items.\n\nVolviendo al menÃº",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "dccfbb57-1a6a-4cab-ae13-8796744d91a4",
      "name": "Send Lista Creada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        154680
      ],
      "webhookId": "2b989aff-f25b-4c8a-a8e7-fd05db685f54",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 704259980,
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=704259980"
        },
        "options": {}
      },
      "id": "29304ebb-77cb-48be-9b20-7a0d7d1e572b",
      "name": "Get Listas Usuario",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        157368
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst telegramUser = String($('Set Variables').first().json.telegram_user);\nconst filtered = items.filter(i => String(i.json.creado_por) === telegramUser);\nif (!filtered.length) {\n  return [{json: {mensaje: 'MIS LISTAS\\n\\nNo tienes listas creadas.\\n\\n9. Volver', list: []}}];\n}\nlet t = 'MIS LISTAS\\n\\n';\nlet list = [];\nfor (let i = 0; i < filtered.length; i++) {\n  t += (i+1) + '. ' + filtered[i].json.nombre_lista + '\\n';\n  list.push({id_lista: filtered[i].json.id_lista, nombre_lista: filtered[i].json.nombre_lista});\n}\nt += '\\n9. Volver';\nreturn [{json: {mensaje: t, list: list}}];"
      },
      "id": "c9f0fb88-4a8a-48dc-90cc-7cbe7e541612",
      "name": "Format Listas Usuario",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        157368
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6617cfc4-c0a7-4451-a005-66117e89f069",
      "name": "Send Listas Usuario",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        157368
      ],
      "webhookId": "c660296e-0b1e-4b53-8d22-e462b893e9f7",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "ver_listas",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Listas Usuario').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "d55d2513-f46f-4acc-8cf7-210edac53f33",
      "name": "Update Session Ver Listas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        157368
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nconst listJson = $('Merge Session Data').first().json.datos_parciales || '[]';\nlet list = [];\ntry { list = JSON.parse(listJson); if (!Array.isArray(list)) list = []; } catch(e) { list = []; }\n\nif (mensaje === '9') { return [{json: {valid: false, cancel: true}}]; }\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length || !list[index - 1]) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida.'}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_lista: selected.id_lista, nombre_lista: selected.nombre_lista}}];"
      },
      "id": "d8d47781-0ecd-421a-928a-f853f371f3b7",
      "name": "Logic Seleccion Lista",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        157968
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "13a507f2-70f3-4470-a8a5-c84d85aafc5a",
      "name": "If Valid Lista",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        157968
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "cefb8f11-5cb0-4515-b9f6-b04562bb6467",
      "name": "If Cancel Ver Listas",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        158040
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Lista').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "03966496-3e74-4233-a506-df8f6cfcad9b",
      "name": "Send Error Ver Listas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        158088
      ],
      "webhookId": "e7976afb-458a-48a0-8102-0ecb4a7be427",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 913068970,
          "cachedResultName": "ITEMS_LISTA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=913068970"
        },
        "options": {}
      },
      "id": "5d733a7d-ae8f-415b-9c0f-156552edf359",
      "name": "Get Items Lista",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        155064
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\n\n// Try to get id_lista and nombre_lista from multiple sources\nlet id_lista, nombre_lista;\ntry { id_lista = $('Logic Seleccion Lista').first().json.id_lista; nombre_lista = $('Logic Seleccion Lista').first().json.nombre_lista; } catch(e) {}\nif (!id_lista) { try { id_lista = $('Logic Agregar Item').first().json.id_lista; nombre_lista = $('Logic Agregar Item').first().json.nombre_lista; } catch(e) {} }\nif (!id_lista) { try { id_lista = $('Logic Seleccion Completar Item').first().json.id_lista; nombre_lista = $('Logic Seleccion Completar Item').first().json.nombre_lista; } catch(e) {} }\nif (!id_lista) { try { id_lista = $('Logic Seleccion Eliminar Item').first().json.id_lista; nombre_lista = $('Logic Seleccion Eliminar Item').first().json.nombre_lista; } catch(e) {} }\nif (!id_lista) { id_lista = datos.id_lista; nombre_lista = datos.nombre_lista; }\nid_lista = String(id_lista || '');\nnombre_lista = nombre_lista || 'Lista';\n\nlet filteredItems = items.filter(i => String(i.json.id_lista) === id_lista && (i.json.estado === 'pendiente' || i.json.estado === 'completado'));\n\nif (!filteredItems.length) {\n  return [{json: {mensaje: nombre_lista.toUpperCase() + '\\n\\n(Sin items)\\n\\n1. Agregar item\\n9. Volver', list: [], id_lista: id_lista, nombre_lista: nombre_lista}}];\n}\n\nlet t = nombre_lista.toUpperCase() + '\\n\\n';\nlet list = [];\nfor (let i = 0; i < filteredItems.length; i++) {\n  const check = filteredItems[i].json.estado === 'completado' ? 'â˜‘' : 'â˜';\n  t += check + ' ' + filteredItems[i].json.item + '\\n';\n  list.push({id_item: filteredItems[i].json.id_item, item: filteredItems[i].json.item, estado: filteredItems[i].json.estado});\n}\nt += '\\n1. Agregar item\\n2. Marcar completado\\n3. Eliminar item\\n9. Volver';\nreturn [{json: {mensaje: t, list: list, id_lista: id_lista, nombre_lista: nombre_lista}}];"
      },
      "id": "ee2d3424-8ed4-4d65-b1aa-8eacc7c2cc86",
      "name": "Format Items Lista",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102464,
        155064
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "dc7e5f01-5720-45d3-9d39-8154875fb4cf",
      "name": "Send Items Lista",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102240,
        155064
      ],
      "webhookId": "9ee67143-a325-411c-8172-ac32e764045d",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "items_lista",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify({id_lista: $('Format Items Lista').first().json.id_lista, nombre_lista: $('Format Items Lista').first().json.nombre_lista, list: $('Format Items Lista').first().json.list}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "20ed4b94-10cb-43e1-b28e-97fd2d48fa96",
      "name": "Update Session Items Lista",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102016,
        155064
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agregar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "completar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "eliminar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "627f70e8-f716-482b-bcf1-a27e00ac7086",
      "name": "Items Lista Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        157248
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Escribe el item a agregar:\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "1a8b8833-786c-47af-9eea-93dd98b3d243",
      "name": "Send Agregar Item",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        156984
      ],
      "webhookId": "c1c6dddf-ebb8-4e83-87ce-014de57d0b7c",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "items_agregar",
            "paso_actual": "1",
            "datos_parciales": "={{ $('Merge Session Data').first().json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "c6319119-da49-41ad-aec0-49166c24916e",
      "name": "Update Session Agregar Item",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        156984
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\n\nif (mensaje === '9') { return [{json: {cancel: true, id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}]; }\n\nconst id_item = 'ITEM-' + Date.now();\nreturn [{json: {cancel: false, id_item: id_item, id_lista: datos.id_lista, item: mensaje, nombre_lista: datos.nombre_lista}}];"
      },
      "id": "4ee56afe-3c2a-4946-98d9-8b49afd3e0ba",
      "name": "Logic Agregar Item",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        155088
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "1ac78104-1816-470a-b3ad-fd0841614e9c",
      "name": "If Cancel Agregar Item",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        155088
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 913068970,
          "cachedResultName": "ITEMS_LISTA"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "={{ $json.id_item }}",
            "id_lista": "={{ $json.id_lista }}",
            "item": "={{ $json.item }}",
            "estado": "pendiente"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "4f4b635f-96db-433f-abeb-51221a4967c8",
      "name": "Insert Item",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        155064
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ“ Item agregado: {{ $('Logic Agregar Item').first().json.item }}\n\nVolviendo a la lista...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "b174c80a-8142-45bd-b9eb-1b7a1ddf2226",
      "name": "Send Item Agregado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        155064
      ],
      "webhookId": "89370c29-7b2f-4cfa-b364-05dfc2e97207",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nconst list = datos.list || [];\nconst pendientes = list.filter(i => i.estado === 'pendiente');\n\nif (!pendientes.length) {\n  return [{json: {mensaje: 'MARCAR COMPLETADO\\n\\nNo hay items pendientes.\\n\\n9. Volver', list: []}}];\n}\n\nlet t = 'MARCAR COMPLETADO\\n\\nSelecciona el item:\\n\\n';\nfor (let i = 0; i < pendientes.length; i++) {\n  t += (i+1) + '. ' + pendientes[i].item + '\\n';\n}\nt += '\\n9. Volver';\nreturn [{json: {mensaje: t, list: pendientes}}];"
      },
      "id": "e3c06d87-6cb8-47dc-8163-e77820f943ab",
      "name": "Format Items Completar",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        157176
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8dfa60a8-cb52-4cb4-9ef7-09c35c8756ee",
      "name": "Send Items Completar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        157176
      ],
      "webhookId": "900d06c0-dde1-4871-9e83-2f8a93fe3dfa",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "items_completar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify({id_lista: JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}').id_lista, nombre_lista: JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}').nombre_lista, list: $('Format Items Completar').first().json.list}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "06d794d0-dc12-4234-ba7a-ef976f5880fb",
      "name": "Update Session Completar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        157176
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nconst list = datos.list || [];\n\nif (mensaje === '9') { return [{json: {valid: false, cancel: true, id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}]; }\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida.', id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_item: selected.id_item, item: selected.item, id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}];"
      },
      "id": "f9f2a40c-ec97-48d9-a242-66b33ebc7da3",
      "name": "Logic Seleccion Completar Item",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        156240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "77d6f6fd-5de4-4df7-a99e-e38d1898ea37",
      "name": "If Valid Completar Item",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        156240
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 913068970,
          "cachedResultName": "ITEMS_LISTA"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "={{ $json.id_item }}",
            "estado": "completado"
          },
          "matchingColumns": [
            "id_item"
          ],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "967df069-bc7b-487e-85a7-dc83a3077ff2",
      "name": "Update Item Completado",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        156168
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=â˜‘ Item completado: {{ $('Logic Seleccion Completar Item').first().json.item }}\n\nVolviendo a la lista...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "ff7c647b-d748-4d58-9e21-e525bdc8ecb4",
      "name": "Send Item Completado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        156168
      ],
      "webhookId": "13af50b0-5491-4a0f-b530-91eebe89508f",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "83a3f333-a6b2-4461-b36f-ab343fb2c6d0",
      "name": "If Cancel Completar Item",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102912,
        156360
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Completar Item').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "a9622583-0a52-4af3-a87c-a9afd8a98b8e",
      "name": "Send Error Completar Item",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        156408
      ],
      "webhookId": "4a6cc94f-bdf1-46d1-990f-522cb6d14da2",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nconst list = datos.list || [];\n\nif (!list.length) {\n  return [{json: {mensaje: 'ELIMINAR ITEM\\n\\nNo hay items para eliminar.\\n\\n9. Volver', list: []}}];\n}\n\nlet t = 'ELIMINAR ITEM\\n\\nSelecciona el item:\\n\\n';\nfor (let i = 0; i < list.length; i++) {\n  t += (i+1) + '. ' + list[i].item + '\\n';\n}\nt += '\\n9. Volver';\nreturn [{json: {mensaje: t, list: list}}];"
      },
      "id": "f4844da6-6247-4a39-8bb3-130da5d3303f",
      "name": "Format Items Eliminar",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103360,
        157560
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "986fd733-6580-4247-9088-002584113c5b",
      "name": "Send Items Eliminar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        157560
      ],
      "webhookId": "1a93bd32-9bac-4651-9ab0-62afefbd1393",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "items_eliminar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify({id_lista: JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}').id_lista, nombre_lista: JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}').nombre_lista, list: $('Format Items Eliminar').first().json.list}) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "02c21c48-498f-4911-a628-db66f760b8f6",
      "name": "Update Session Eliminar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        157560
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = String($('Set Variables').first().json.mensaje).trim();\nconst datos = JSON.parse($('Merge Session Data').first().json.datos_parciales || '{}');\nconst list = datos.list || [];\n\nif (mensaje === '9') { return [{json: {valid: false, cancel: true, id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}]; }\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida.', id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_item: selected.id_item, item: selected.item, id_lista: datos.id_lista, nombre_lista: datos.nombre_lista}}];"
      },
      "id": "8b29b442-4aea-474f-8b7e-33dc3ff81c33",
      "name": "Logic Seleccion Eliminar Item",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        158824
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "058737d3-3149-4777-bbc3-07ae14be5064",
      "name": "If Valid Eliminar Item",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        158824
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 913068970,
          "cachedResultName": "ITEMS_LISTA"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "={{ $json.id_item }}",
            "estado": "eliminado"
          },
          "matchingColumns": [
            "id_item"
          ],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "a874eb19-1e17-4491-96c3-73740d770bc0",
      "name": "Update Item Eliminado",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        158712
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=ðŸ—‘ Item eliminado: {{ $('Logic Seleccion Eliminar Item').first().json.item }}\n\nVolviendo a la lista...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "540846f9-7744-4f24-83a9-9be2c2a91a36",
      "name": "Send Item Eliminado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        158712
      ],
      "webhookId": "7bb3cae8-4663-45e3-838a-f5987570c2b2",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c06ec0f4-823b-4463-93df-b3c0c051ec20",
      "name": "If Cancel Eliminar Item",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102912,
        158920
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Eliminar Item').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c411c7dd-f818-4096-978f-330e5069ad55",
      "name": "Send Error Eliminar Item",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        158968
      ],
      "webhookId": "61906e06-d883-49d4-9c4b-de50adfd9ba3",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida en Listas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "4701f316-b338-4036-bb64-687f9fff0bd2",
      "name": "Send Invalid Listas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        158616
      ],
      "webhookId": "18e51f63-0ab2-473e-9224-8b44864364f2",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "3ecfcd0a-3d6b-4b84-b594-9f6b30118557",
      "name": "Send Invalid Items Lista",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        157752
      ],
      "webhookId": "4bc8b1cd-d153-47b3-9e27-9934f5d73768",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "ðŸ“Š REPORTES\n\n1. Resumen del dÃ­a\n2. Resumen semanal\n3. Productividad\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "acf7906c-d4cd-40cb-96c0-1e1f3506a75a",
      "name": "Send Reportes Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        160888
      ],
      "webhookId": "44b9fd01-c18f-4118-8896-f052638f35cf",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "reportes_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "5511e21c-e06c-4aea-bffa-f4dfd5667461",
      "name": "Update to Reportes",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        160888
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "âš™ï¸ CONFIGURACIÃ“N\n\n1. Mi informaciÃ³n\n2. Cambiar nombre\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d362ac6d-7d0c-45be-8238-cee9e52f86de",
      "name": "Send Config Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        161080
      ],
      "webhookId": "feff8cb3-3df3-44f4-81b7-51cf70a0d814",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "config_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "6d2ef0f3-881f-4190-a0ad-ded564811254",
      "name": "Update to Config",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        161080
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "ðŸ‘‘ ADMINISTRACIÃ“N\n\n1. Ver usuarios\n2. EstadÃ­sticas\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "707de82d-3329-49b9-a6f3-af9d48fe24c9",
      "name": "Send Admin Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        160792
      ],
      "webhookId": "30c27c63-1d53-4420-bc9f-d0e7458fc9f8",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "admin_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "96fb0de6-a9a3-4544-801f-5cfb1b99dbec",
      "name": "Update to Admin",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        160792
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ver_usuarios"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "estadisticas"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "be595ac8-7bd7-4a83-ba5a-c54d784a9831",
      "name": "Admin Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        161832
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Esta funciÃ³n estÃ¡ en desarrollo.\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "7eb36dd5-4e75-4471-bc01-489e9b52ad95",
      "name": "Send Admin En Desarrollo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -105376,
        173048
      ],
      "webhookId": "92145809-5cef-4b87-8235-dbee9b52ca4b",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "OpciÃ³n no vÃ¡lida.\n\n1. Ver usuarios\n2. EstadÃ­sticas\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6a0b09a6-95a7-416e-ae04-d1d2950af31e",
      "name": "Send Admin Invalid",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        162056
      ],
      "webhookId": "773c082e-dd58-4aa3-bc41-26c557164547",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "options": {}
      },
      "id": "cf1b882e-229b-4ef6-ac7f-584502a2e3d6",
      "name": "Get All Usuarios",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        161864
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const usuarios = $input.all();\n\nlet mensaje = 'ðŸ‘¥ USUARIOS REGISTRADOS\\n\\n';\n\nif (usuarios.length === 0) {\n  mensaje += 'No hay usuarios registrados.';\n} else {\n  usuarios.forEach((u, i) => {\n    const nombre = u.json.nombre || 'Sin nombre';\n    const rol = u.json.rol || 'usuario';\n    const permitido = u.json.permitido === 'true' ? 'âœ…' : 'âŒ';\n    mensaje += `${i + 1}. ${nombre} (${rol}) ${permitido}\\n`;\n  });\n  mensaje += `\\nTotal: ${usuarios.length} usuario(s)`;\n}\n\nmensaje += '\\n\\n9. Volver';\n\nreturn [{ json: { mensaje } }];"
      },
      "id": "33e39d1e-36fc-4dbb-b70c-d6eb8916250a",
      "name": "Format Usuarios",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        161864
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "7567ad87-9e97-4044-bd6e-7c7cf42a15e6",
      "name": "Send Usuarios List",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        161864
      ],
      "webhookId": "001dd6da-08ed-4539-ac5e-645d59266132",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "options": {}
      },
      "id": "34ede57e-2674-46b8-a455-ebd80b5216dd",
      "name": "Get Stats Citas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        161672
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "options": {}
      },
      "id": "87879c53-90ad-4664-a282-3954ada3da72",
      "name": "Get Stats Tareas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        161672
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "options": {}
      },
      "id": "0ad52c75-1165-4cac-93c9-0df3610d3529",
      "name": "Get Stats Habitos",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        161672
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 704259980,
          "cachedResultName": "LISTAS"
        },
        "options": {}
      },
      "id": "b9534186-1add-41ec-9269-cbc10c5bdd16",
      "name": "Get Stats Listas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        161672
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const citas = $('Get Stats Citas').all();\nconst tareas = $('Get Stats Tareas').all();\nconst habitos = $('Get Stats Habitos').all();\nconst listas = $('Get Stats Listas').all();\n\nconst totalCitas = citas.length;\nconst totalTareas = tareas.length;\nconst totalHabitos = habitos.length;\nconst totalListas = listas.length;\n\nconst citasPendientes = citas.filter(c => c.json.estado === 'pendiente').length;\nconst tareasActivas = tareas.filter(t => t.json.estado === 'activa').length;\nconst habitosActivos = habitos.filter(h => h.json.estado === 'activo').length;\n\nconst mensaje = `ðŸ“Š ESTADÃSTICAS DEL SISTEMA\\n\\nðŸ“… Citas: ${totalCitas} total (${citasPendientes} pendientes)\\nâœ… Tareas: ${totalTareas} total (${tareasActivas} activas)\\nðŸ”„ HÃ¡bitos: ${totalHabitos} total (${habitosActivos} activos)\\nðŸ“ Listas: ${totalListas} total\\n\\n9. Volver`;\n\nreturn [{ json: { mensaje } }];"
      },
      "id": "d3e2c20d-770c-4fd9-b662-e0f27ed9e430",
      "name": "Format Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102464,
        161672
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "b4c93611-fdd0-46fe-8e8e-106a4f3417d5",
      "name": "Send Stats",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102240,
        161672
      ],
      "webhookId": "e42fbad1-f4d0-455d-89a6-494265a18846",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "={{ $json.pantalla === 'menu_principal' ? 'Opcion no valida. Escribe 0-6.\\n\\nMENU\\n0. Ayuda\\n1. Agenda\\n2. Tareas\\n3. Recordatorios\\n4. Habitos\\n5. Listas\\n6. Reportes' : 'Opcion no valida. Presiona \"9\" para ir al menÃº principal.' }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "64f58191-dcae-4350-9e2f-586e29cbed46",
      "name": "Send Invalid Option",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        161200
      ],
      "webhookId": "65fa2ff9-5e6c-4c68-8883-e1ac385a2597",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "MENU\n0. Ayuda\n1. Agenda\n2. Tareas\n3. Recordatorios\n4. Habitos\n5. Listas\n6. Reportes\n7. Config\n8. Admin",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "03ccf0c8-670a-482a-b683-c4c78fe28762",
      "name": "Send Menu Principal",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101344,
        156480
      ],
      "webhookId": "45631ab8-208d-4386-bd31-3c9222a55563",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "ayuda_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "9421525a-714b-40a4-8543-6ebc5893eff3",
      "name": "Update to Ayuda",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        160024
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "bb281b2f-ec57-4d17-9f03-1fe382d09778",
      "name": "Ayuda Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        162688
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "aecba26b-61f9-4c6e-94d9-f1168b90bb6b",
      "name": "Update Volver Menu",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101120,
        156576
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "crear_cita"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "consultar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reprogramar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar_cita"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "completar_cita"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "24f9b74d-accc-4848-ac51-008e8a9b8b64",
      "name": "Agenda Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        164200
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "CREAR CITA - Paso 1/6\n\nFecha? (YYYY-MM-DD)\nEj: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f98cefe8-f7a9-4004-a819-eaa22fd366eb",
      "name": "Send Agenda Paso 1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        163744
      ],
      "webhookId": "4d888603-60fe-40d4-a4a4-166e31b410e5",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_1",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "91452749-eee2-4c70-8544-7bc07c54f5fa",
      "name": "Update Agenda Paso 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        163744
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').item.json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "61474422-4ddd-46df-9272-38904d2eb42f",
      "name": "Get Citas Usuario",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        163936
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c958ad4f-644d-4ebd-ba23-ea6bac72e051",
      "name": "Send Consultar Citas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        163936
      ],
      "webhookId": "1952b1bd-5052-4cc8-961f-42e179c4571a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "consultar_citas",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "7afad63c-0fc8-4e98-a709-295d42bb5e52",
      "name": "Update Session Consultar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        163936
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "bc05f1ec-622a-43fe-be69-679455e58198",
      "name": "Consultar Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        163408
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver al menu de agenda.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "761724c7-e90a-4e71-b8ab-3b6c69efe217",
      "name": "Send Invalid Consultar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        163456
      ],
      "webhookId": "c747125c-8ace-4b01-9bd6-7cd441d013d3",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.fecha) {\n  return [{json:{mensaje:'TUS CITAS:\\n\\nNo tienes citas pendientes.\\n\\n9. Volver'}}];\n}\nlet t = 'TUS CITAS:\\n\\n';\nfor (let i = 0; i < items.length; i++) {\n  t += (i+1)+'. '+items[i].json.fecha+' '+items[i].json.hora+' - '+items[i].json.nombre+'\\n';\n}\nreturn [{json:{mensaje:t+'\\n9. Volver'}}];"
      },
      "id": "e49e79be-1db5-4e98-8c8f-98992da576de",
      "name": "Format Citas Lista",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102912,
        163936
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para ir al menÃº principal.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "14877e58-5fa7-4233-8f85-7a2d3af77c8b",
      "name": "Send Invalid Agenda",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        164128
      ],
      "webhookId": "6f9d5ea2-acb6-42b6-a022-387d52c3be48",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Esta funcion esta en desarrollo.\n\n9. Volver al menu principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "30c2ce67-b462-441b-bd6f-4f440811fcaa",
      "name": "Send En Desarrollo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -105376,
        173496
      ],
      "webhookId": "fdb05f31-c445-4660-b66f-2a8bc5b39d90",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso3"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_4",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso4"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_5",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso5"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "agenda_crear_paso_6",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso6"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "49df9a86-7e09-42a2-bda7-e021abf67d05",
      "name": "Agenda Wizard Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        165736
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "023d607a-5e5b-4686-b3a9-70de4a4c214a",
      "name": "Cancelar?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        165248
      ]
    },
    {
      "parameters": {
        "jsCode": "const fecha = $('Set Variables').first().json.mensaje;\nconst regex = /^\\d{4}-\\d{2}-\\d{2}$/;\n\nif (!regex.test(fecha)) {\n  return { json: { valid: false, error: 'Formato incorrecto. Usa YYYY-MM-DD', fecha } };\n}\n\nconst fechaIngresada = new Date(fecha + 'T00:00:00');\nconst hoy = new Date();\nhoy.setHours(0, 0, 0, 0);\n\nif (fechaIngresada < hoy) {\n  return { json: { valid: false, error: 'No puedes agendar en una fecha pasada.', fecha } };\n}\n\nreturn { json: { valid: true, fecha } };"
      },
      "id": "65951416-b1d9-4041-a184-476cbbff48bd",
      "name": "Validar Fecha",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        165296
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "0e7e8800-8985-4961-9962-dd4e035f17ae",
      "name": "If Fecha Valida",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102912,
        165296
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ fecha: $('Validar Fecha').first().json.fecha }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "61c45cf7-57fa-448b-b83f-42c337296da3",
      "name": "Set Fecha",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102688,
        165088
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Paso 2/6 - Hora? (HH:MM)\nEj: 14:30\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "43e80660-3481-4eec-9f9f-f38d23146ce0",
      "name": "Send Paso 2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102240,
        165088
      ],
      "webhookId": "3d76f4b0-6f25-4756-870d-31c32026135c",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_2",
            "paso_actual": "2",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8d936b2d-880f-4797-8033-06f53ca8b86c",
      "name": "Update Paso 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        165088
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Validar Fecha').first().json.error }}\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c568911b-44e7-4b44-83e4-c4c32e22d3ac",
      "name": "Error Fecha",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        165392
      ],
      "webhookId": "54a4fb6c-28d6-4844-8d32-e72234220063",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "268fdf43-4882-40cf-8844-57a99305ad68",
      "name": "Cancelar 2?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        165632
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "^\\d{2}:\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "7445ab78-a23d-4558-9b85-b4da6f812737",
      "name": "Validar Hora",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        165680
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), hora: $('Set Variables').item.json.mensaje }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "faa9a418-a9f2-417b-ba30-914497ef4165",
      "name": "Set Hora",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102912,
        165584
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Paso 3/6 - Nombre cliente?\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "bba3f937-2f5c-421d-9e43-3a10bd53508d",
      "name": "Send Paso 3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102464,
        165584
      ],
      "webhookId": "c40e0757-23e2-4dba-a99c-f0e157b4c9d3",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_3",
            "paso_actual": "3",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "c083b02d-d947-42b8-94a0-1d7eff293d8d",
      "name": "Update Paso 3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        165584
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Formato incorrecto. Usa HH:MM\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "01373a75-94e6-4e26-9106-fd9d18e4aecd",
      "name": "Error Hora",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        165776
      ],
      "webhookId": "10302139-a3a5-47f0-b855-4bef2988b9ba",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "143dd86a-d701-48a3-bc3c-e2bf123ee167",
      "name": "Cancelar 3?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        165920
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), nombre: $('Set Variables').item.json.mensaje }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "ec015bb6-24c1-4796-91ae-3934ac59a0a3",
      "name": "Set Nombre",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        165968
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Paso 4/6 - Motivo?\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2bb2fed7-c9bf-4540-8920-8264b6e62e49",
      "name": "Send Paso 4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        165968
      ],
      "webhookId": "529d9a9d-eb7b-401a-8fbf-56bd175e5eb0",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_4",
            "paso_actual": "4",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "a0288014-d554-451d-9566-541ce7171bd0",
      "name": "Update Paso 4",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        165968
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e2344f8b-9965-4d45-924b-e6fd77160e39",
      "name": "Cancelar 4?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        166112
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), motivo: $('Set Variables').item.json.mensaje }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "0c829bb9-6655-4980-b261-9483514f5e05",
      "name": "Set Motivo",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        166160
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Paso 5/6 - Canal?\n\n1. Presencial\n2. Virtual\n3. Llamada\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "de383c57-0b8a-419c-882c-470feb946420",
      "name": "Send Paso 5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        166160
      ],
      "webhookId": "0de5a313-d9ea-4d93-a1fe-00ad758d9464",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_5",
            "paso_actual": "5",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "926b0f3d-f0d8-4452-a4ea-dcf0c0638fee",
      "name": "Update Paso 5",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        166160
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "presencial"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "virtual"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "llamada"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "a0e7bd15-b76a-435d-8db1-8699dbaced5d",
      "name": "Canal Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        166592
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), canal: 'Presencial' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "686d085d-a3b5-45a4-b385-de058347cb2c",
      "name": "Set Presencial",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        166448
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), canal: 'Virtual' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3ca0ba3b-77ef-49a7-83eb-753be5100e34",
      "name": "Set Virtual",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        166640
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), canal: 'Llamada' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "6c449984-54db-45f3-8810-bd7ae10765e2",
      "name": "Set Llamada",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        166832
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "=Paso 6/6 - CONFIRMAR:\n\n{{ (() => { try { const d = JSON.parse($json.datos_parciales || '{}'); return 'Fecha: ' + d.fecha + '\\nHora: ' + d.hora + '\\nCliente: ' + d.nombre + '\\nMotivo: ' + d.motivo + '\\nCanal: ' + d.canal; } catch(e) { return 'Error: ' + e.message; } })() }}\n\n1. Confirmar\n2. Editar\n3. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8b374450-4994-40aa-ba75-fed494edfa43",
      "name": "Send Paso 6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        166544
      ],
      "webhookId": "794d2796-36be-421d-a174-2eb212240e6b",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "agenda_crear_paso_6",
            "paso_actual": "6",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "72afaa65-1513-4c36-a4fb-5c2d41125b77",
      "name": "Update Paso 6",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        166544
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirmar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "editar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "0c052909-de1b-4c97-897c-f7ebdb7ca136",
      "name": "Confirmar Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        167072
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "id_cita",
              "value": "={{ 'CITA-' + Date.now() }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "fecha",
              "value": "={{ JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}').fecha }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "hora",
              "value": "={{ JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}').hora }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "nombre",
              "value": "={{ JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}').nombre }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "motivo",
              "value": "={{ JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}').motivo }}",
              "type": "string"
            },
            {
              "id": "6",
              "name": "canal",
              "value": "={{ JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}').canal }}",
              "type": "string"
            },
            {
              "id": "7",
              "name": "estado",
              "value": "pendiente",
              "type": "string"
            },
            {
              "id": "8",
              "name": "creado_por",
              "value": "={{ String($('Set Variables').item.json.telegram_user) }}",
              "type": "string"
            },
            {
              "id": "9",
              "name": "timestamp_creacion",
              "value": "={{ $('Set Variables').item.json.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e10052f5-8452-42d6-b732-c6aa415849ce",
      "name": "Parse Cita",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -103136,
        167216
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "CITAS",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $('Parse Cita').first().json.id_cita }}",
            "fecha": "={{ $('Parse Cita').first().json.fecha }}",
            "hora": "={{ $('Parse Cita').first().json.hora }}",
            "nombre": "={{ $('Parse Cita').first().json.nombre }}",
            "motivo": "={{ $('Parse Cita').first().json.motivo }}",
            "canal": "={{ $('Parse Cita').first().json.canal }}",
            "estado": "={{ $('Parse Cita').first().json.estado }}",
            "creado_por": "={{ $('Parse Cita').first().json.creado_por }}",
            "timestamp_creacion": "={{ $('Parse Cita').first().json.timestamp_creacion }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "fff271fe-d1b4-4e69-994f-12ddc6593d5a",
      "name": "Guardar Cita",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        167672
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "=CITA GUARDADA!\n\nID: {{ $('Parse Cita').item.json.id_cita }}\nFecha: {{ $('Parse Cita').item.json.fecha }}\nHora: {{ $('Parse Cita').item.json.hora }}\n\n(Regresando al menÃº principal...)",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "17771b1d-5b38-49ec-b9f4-1655fb54a369",
      "name": "Cita OK",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102016,
        167672
      ],
      "webhookId": "19d6e4db-a355-472d-95bf-8f8c23659a80",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=319260215"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "4413d704-b436-46ec-a718-8f110066e3b8",
      "name": "Update After Cita",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102240,
        167672
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "a7ec1a2d-cb20-4f0b-8efb-93ebec88cac5",
      "name": "Volver Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103360,
        172824
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "crear"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pendientes"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "completadas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "completar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "eliminar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "3894f53e-5afa-407b-935e-596860934f98",
      "name": "Tareas Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        169264
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "CREAR TAREA\n\nEscribe el titulo de la tarea:\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2ed39b81-7142-4ed1-ac64-084ef1a50265",
      "name": "Send Tarea Paso 1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        168672
      ],
      "webhookId": "71457b51-b827-48c3-8fa9-0a1e2c78fce4",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "tarea_crear_paso_1",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "937e5c95-50f6-4cc0-afcc-0d587431c46a",
      "name": "Update Tarea Paso 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        168672
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').item.json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "bef05adb-77e7-4ae2-b7e8-0f10742fcce1",
      "name": "Get Tareas Pendientes",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        168864
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5c064e7e-9a8a-4c82-a3dd-67358ea8d4ef",
      "name": "Send Tareas Pendientes",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        168864
      ],
      "webhookId": "d29a2c1f-43b1-462c-b19e-1186215e70bb",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.titulo) {\n  return [{json:{mensaje:'TAREAS PENDIENTES:\\n\\nNo tienes tareas pendientes.\\n\\n9. Volver'}}];\n}\nlet t = 'TAREAS PENDIENTES:\\n\\n';\nfor (let i = 0; i < items.length; i++) {\n  const fecha = items[i].json.fecha_objetivo ? ' - Fecha: ' + items[i].json.fecha_objetivo : '';\n  const prioridad = items[i].json.prioridad ? ' - Prioridad: ' + items[i].json.prioridad : '';\n  t += (i+1)+'. '+items[i].json.titulo + fecha + prioridad + '\\n';\n}\nreturn [{json:{mensaje:t+'\\n9. Volver'}}];"
      },
      "id": "ad2e4383-e2f2-4d27-85a5-3a9777a00561",
      "name": "Format Tareas Pendientes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        168864
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "ver_tareas_pendientes",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "60031c0e-a77c-4e54-9030-be76f1bdc4a9",
      "name": "Update Session Ver Pendientes",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        168864
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "5aed868f-f19e-4872-9494-adf5e28b4477",
      "name": "Ver Pendientes Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        168360
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver al menu de tareas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "4099781f-f4bd-4b57-a7be-397b9fe0b830",
      "name": "Send Invalid Ver Pendientes",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        169848
      ],
      "webhookId": "e7cfa643-d74d-49d5-9fe7-69d8ca22c99f",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').item.json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "completada"
            }
          ]
        },
        "options": {}
      },
      "id": "17a8dbbf-dfdd-495c-9698-4715ab8b3804",
      "name": "Get Tareas Completadas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        169056
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "83ab9e67-6bde-4f64-a383-ada2f106f9b1",
      "name": "Send Tareas Completadas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        169056
      ],
      "webhookId": "08961623-960e-4664-abe4-4c00ae10a5b4",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.titulo) {\n  return [{json:{mensaje:'TAREAS COMPLETADAS:\\n\\nNo tienes tareas completadas.\\n\\n9. Volver'}}];\n}\nlet t = 'TAREAS COMPLETADAS:\\n\\n';\nfor (let i = 0; i < items.length; i++) {\n  t += (i+1)+'. '+items[i].json.titulo + ' âœ“\\n';\n}\nreturn [{json:{mensaje:t+'\\n9. Volver'}}];"
      },
      "id": "c5e8e10d-1022-4619-ae87-3c975d15d3f3",
      "name": "Format Tareas Completadas",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        169056
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "ver_tareas_completadas",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "7df1d6e6-3f0f-44cb-8536-8578f0c775ec",
      "name": "Update Session Ver Completadas",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        169056
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "fd2fe9a9-3ebd-4626-a58a-32c398f29f31",
      "name": "Ver Completadas Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        169816
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver al menu de tareas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "22273916-4b2d-4992-aa1d-0f340f0239c8",
      "name": "Send Invalid Ver Completadas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        170664
      ],
      "webhookId": "3e620326-fe53-4e44-991e-bc94909e65da",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Esta funcion esta en desarrollo.\n\n9. Volver al menu principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "68341904-c09e-4a36-a776-5e41f3f4b0a0",
      "name": "Send Tarea En Desarrollo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -105376,
        173720
      ],
      "webhookId": "5f139d57-31ed-407b-9997-28339f4dd806",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para ir al menÃº principal.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "84ca9b50-587d-4623-b5da-06a2d5943604",
      "name": "Send Invalid Tarea",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        169248
      ],
      "webhookId": "54979764-291d-4640-a20e-16d8717ced43",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').item.json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "3eb6b6e2-5f9e-4009-a008-e5f7ab673eda",
      "name": "Get Tareas Para Completar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        169440
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.titulo) {\n  return [{json:{mensaje:'COMPLETAR TAREA:\\n\\nNo tienes tareas pendientes para completar.\\n\\n9. Volver', list: []}}];\n}\nlet t = 'COMPLETAR TAREA:\\n\\nSelecciona el numero de la tarea a completar:\\n\\n';\nconst list = [];\nfor (let i = 0; i < items.length; i++) {\n  const prioridad = items[i].json.prioridad ? ' - Prioridad: ' + items[i].json.prioridad : '';\n  t += (i+1)+'. '+items[i].json.titulo + prioridad + '\\n';\n  list.push({index: i+1, id_tarea: items[i].json.id_tarea, titulo: items[i].json.titulo});\n}\nreturn [{json:{mensaje:t+'\\n9. Volver', list: list}}];"
      },
      "id": "a19ed0ed-4544-4ca0-bc85-7ad4b5e520b0",
      "name": "Format Lista Completar Tareas",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        169440
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "94211ad0-bd6f-48b2-8aa7-d7b9bed80630",
      "name": "Send Lista Completar Tareas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        169440
      ],
      "webhookId": "2fa3bef5-656e-4963-924e-f28e5ad1262d",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "tarea_completar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Completar Tareas').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "bf765cfd-bf8a-4abc-ac1a-ef609a06975e",
      "name": "Update Session Completar Tarea",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        169440
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nconst listJson = $('Merge Session Data').first().json.datos_parciales || '[]';\nlet list = [];\ntry {\n  list = JSON.parse(listJson);\n  if (!Array.isArray(list)) list = [];\n} catch(e) {\n  list = [];\n}\n\nif (mensaje === '9') {\n  return [{json: {valid: false, cancel: true}}];\n}\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length || !list[index - 1]) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida. Escribe el numero de la tarea o 9 para volver.'}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_tarea: selected.id_tarea, titulo: selected.titulo}}];"
      },
      "id": "ae58c06b-52dc-481f-977f-4eb0699880fd",
      "name": "Logic Seleccion Completar Tarea",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102464,
        170344
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ae992fe5-6dbb-4209-b1a2-9dcb2df5a3a7",
      "name": "If Valid Completar Tarea",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102240,
        170344
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_tarea": "={{ $json.id_tarea }}",
            "estado": "completada"
          },
          "matchingColumns": [
            "id_tarea"
          ]
        },
        "options": {}
      },
      "id": "2a73d29e-88fd-40bf-8cd6-5adc73d876fd",
      "name": "Update Tarea Completada",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102016,
        170248
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Tarea completada: {{ $('Logic Seleccion Completar Tarea').first().json.titulo }}\n\n9. Volver al menu de tareas",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f36c29cc-bdd9-42ed-b0a3-15812fe6b77f",
      "name": "Send Tarea Completada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        171048
      ],
      "webhookId": "7f331e41-8627-439b-90a5-924120da63d5",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5415f5c1-c52e-4e03-abca-51fc392b690e",
      "name": "If Cancel Completar Tarea",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102016,
        170440
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Completar Tarea').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "405cdbb9-a9aa-4c71-aa7a-62e01711596f",
      "name": "Send Error Completar Tarea",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        171288
      ],
      "webhookId": "ed08f888-ef75-41eb-b524-8889a601f0e0",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "tarea_completada_confirm",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "92148941-d507-4e8b-a7e9-bab2e89804a1",
      "name": "Update Session Tarea Completada",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        171048
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "47addb63-b540-42b1-8d77-ec24f44735bd",
      "name": "Tarea Completada Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        170008
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver al menu de tareas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8095254f-b9c8-4ac7-9495-06a49fdee187",
      "name": "Send Invalid Tarea Completada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        170856
      ],
      "webhookId": "05aa8380-3dad-4ee4-ab57-26f0e9150d8a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').item.json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "2e085125-3d2d-423d-bb90-0ab2dcd5fd3f",
      "name": "Get Tareas Para Eliminar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        169632
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items.length || !items[0].json.titulo) {\n  return [{json:{mensaje:'ELIMINAR TAREA:\\n\\nNo tienes tareas pendientes para eliminar.\\n\\n9. Volver', list: []}}];\n}\nlet t = 'ELIMINAR TAREA:\\n\\nSelecciona el numero de la tarea a eliminar:\\n\\n';\nconst list = [];\nfor (let i = 0; i < items.length; i++) {\n  const prioridad = items[i].json.prioridad ? ' - Prioridad: ' + items[i].json.prioridad : '';\n  t += (i+1)+'. '+items[i].json.titulo + prioridad + '\\n';\n  list.push({index: i+1, id_tarea: items[i].json.id_tarea, titulo: items[i].json.titulo});\n}\nreturn [{json:{mensaje:t+'\\n9. Volver', list: list}}];"
      },
      "id": "663805b3-f107-4a38-b0e3-7184423d37d5",
      "name": "Format Lista Eliminar Tareas",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        169632
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "a91a0857-4201-4a6f-bc6d-ff170c2a3cdb",
      "name": "Send Lista Eliminar Tareas",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        169632
      ],
      "webhookId": "ec27ffbc-6de2-48a4-920d-3613ca720028",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "tarea_eliminar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Eliminar Tareas').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "aa544f98-1c8c-4a97-bf83-dc3744e30a47",
      "name": "Update Session Eliminar Tarea",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        169632
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const mensaje = $('Set Variables').first().json.mensaje;\nconst listJson = $('Merge Session Data').first().json.datos_parciales || '[]';\nlet list = [];\ntry {\n  list = JSON.parse(listJson);\n  if (!Array.isArray(list)) list = [];\n} catch(e) {\n  list = [];\n}\n\nif (mensaje === '9') {\n  return [{json: {valid: false, cancel: true}}];\n}\n\nconst index = parseInt(mensaje);\nif (isNaN(index) || index < 1 || index > list.length || !list[index - 1]) {\n  return [{json: {valid: false, cancel: false, error: 'Seleccion no valida. Escribe el numero de la tarea o 9 para volver.'}}];\n}\n\nconst selected = list[index - 1];\nreturn [{json: {valid: true, id_tarea: selected.id_tarea, titulo: selected.titulo}}];"
      },
      "id": "92aab75c-19b2-4549-8a05-61f4e8ee65b0",
      "name": "Logic Seleccion Eliminar Tarea",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102464,
        172512
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "071b4e2f-4312-473b-b2cd-04805673fe14",
      "name": "If Valid Eliminar Tarea",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102240,
        172512
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_tarea": "={{ $json.id_tarea }}",
            "estado": "eliminada"
          },
          "matchingColumns": [
            "id_tarea"
          ]
        },
        "options": {}
      },
      "id": "8dab68e4-c964-4668-9ddd-8370948fc6e5",
      "name": "Delete Tarea",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102016,
        172416
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=ðŸ—‘ï¸ Tarea eliminada: {{ $('Logic Seleccion Eliminar Tarea').first().json.titulo }}\n\n9. Volver al menu de tareas",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5f07399c-8ace-40a6-b068-adca09f2b5c5",
      "name": "Send Tarea Eliminada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        172536
      ],
      "webhookId": "fc1e612a-e7f3-4796-9285-e38589bfd44e",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.cancel }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "31b45526-decc-4221-b1af-79698e8cd7c4",
      "name": "If Cancel Eliminar Tarea",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102016,
        172608
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Eliminar Tarea').first().json.error }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "9744e8b3-6104-4ae5-9150-573ddc2ee4ee",
      "name": "Send Error Eliminar Tarea",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        172776
      ],
      "webhookId": "92a4a29a-d178-4955-8790-b35ab34ea261",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "tarea_eliminada_confirm",
            "paso_actual": "1",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "7ae27572-f07b-42ef-9c97-f1955f01e443",
      "name": "Update Session Tarea Eliminada",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        172536
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "b77bcf23-01ad-4e61-b180-7b9e2076238c",
      "name": "Tarea Eliminada Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        172176
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Opcion no valida. Presiona 9 para volver al menu de tareas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "74b34514-7f81-4948-8008-65547298b12b",
      "name": "Send Invalid Tarea Eliminada",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        172344
      ],
      "webhookId": "a529cdd3-2b82-4672-8b9b-20825891b52a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_crear_paso_1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso1"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_crear_paso_2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso2"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla }}",
                    "rightValue": "tarea_crear_paso_3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "paso3"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "4259379a-f478-4842-bbec-73f38dff94a0",
      "name": "Tarea Wizard Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        171288
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5a7a2208-1426-41da-89a8-ce7d1ec99f50",
      "name": "Cancelar Tarea?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102016,
        170632
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "id_tarea",
              "value": "={{ 'TAREA-' + Date.now() }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "titulo",
              "value": "={{ JSON.parse($json.datos_parciales || '{}').titulo || '' }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "prioridad",
              "value": "={{ JSON.parse($json.datos_parciales || '{}').prioridad || 'media' }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "estado",
              "value": "pendiente",
              "type": "string"
            },
            {
              "id": "5",
              "name": "fecha_objetivo",
              "value": "={{ JSON.parse($json.datos_parciales || '{}').fecha_objetivo || '' }}",
              "type": "string"
            },
            {
              "id": "6",
              "name": "creado_por",
              "value": "={{ $('Set Variables').item.json.telegram_user }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3ea9f337-2dbe-4a59-85c0-51c2578c7042",
      "name": "Parse Tarea",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102688,
        171824
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {}
        },
        "options": {}
      },
      "id": "6fac8e4a-fb7a-45a3-b939-1a9b4108d462",
      "name": "Guardar Tarea",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        171824
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "=TAREA CREADA!\n\nTitulo: {{ $('Parse Tarea').item.json.titulo }}\nPrioridad: {{ $('Parse Tarea').item.json.prioridad }}\nFecha: {{ $('Parse Tarea').item.json.fecha_objetivo || 'Sin fecha' }}\n\n(Volviendo al menu de tareas...)",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6f337a70-4af1-4a71-94d5-0324de53d09c",
      "name": "Tarea OK",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102240,
        171824
      ],
      "webhookId": "a3bd33d0-9edd-4680-9afc-f2bd3b36359e",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "tareas_menu",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "fb1ef0d7-c848-45f0-9ba8-ed08d918136b",
      "name": "Update After Tarea",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102016,
        171824
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ titulo: $('Set Variables').item.json.mensaje }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "4f76ce2a-54da-4b80-8c93-441488954c77",
      "name": "Set Titulo Tarea",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -101792,
        171480
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "tarea_crear_paso_2",
            "paso_actual": "2",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "b2558995-2395-4151-babd-fa7ba1d94ef6",
      "name": "Update Tarea Paso 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        171480
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "CREAR TAREA - Paso 2/3\n\nPrioridad?\n\n1. Alta\n2. Media\n3. Baja\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "99586031-dad5-4d9c-8eda-ee37589c72e8",
      "name": "Send Tarea Paso 2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101344,
        171480
      ],
      "webhookId": "cbc29f99-733a-452e-a909-10cfc49d4633",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f42d5937-2a42-4b99-870f-9f030e19c51a",
      "name": "Cancelar Tarea 2?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        171160
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "alta"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "media"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "baja"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "397dbe64-325d-4587-b074-2ca77eb605ad",
      "name": "Prioridad Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103136,
        171296
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), prioridad: 'alta' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e065e10a-039e-4573-892b-1e2052d59703",
      "name": "Set Prioridad Alta",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102912,
        170944
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), prioridad: 'media' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e14f33dc-0dcd-4932-bd9a-a5891f08cefc",
      "name": "Set Prioridad Media",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102912,
        171136
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), prioridad: 'baja' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "daf62f7d-773c-46da-b2c1-85e25cda5d62",
      "name": "Set Prioridad Baja",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102912,
        171328
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').item.json.telegram_user }}",
            "pantalla_actual": "tarea_crear_paso_3",
            "paso_actual": "3",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').item.json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "5a38fa8e-e55e-48ba-8ebb-c3552fd10256",
      "name": "Update Tarea Paso 3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        171040
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "CREAR TAREA - Paso 3/3\n\nFecha objetivo? (YYYY-MM-DD)\nEj: 2025-02-15\n\nEscribe 0 para saltar\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8fe3e325-9dcc-4ba5-871e-5598494f10ab",
      "name": "Send Tarea Paso 3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102464,
        171040
      ],
      "webhookId": "bb3ade50-1628-4a33-82c8-fb5382a69867",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a4a99b97-5bce-403b-ac6d-8fe88ddeedf4",
      "name": "Cancelar Tarea 3?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        171848
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').item.json.mensaje }}",
              "rightValue": "^(\\d{4}-\\d{2}-\\d{2}|0)$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "6189bfc4-f969-4688-97d9-6352c4af0e34",
      "name": "Fecha Valida?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103136,
        171920
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "datos_parciales",
              "value": "={{ JSON.stringify({ ...JSON.parse($('Merge Session Data').item.json.datos_parciales || '{}'), fecha_objetivo: $('Set Variables').item.json.mensaje === '0' ? '' : $('Set Variables').item.json.mensaje }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "b44a2425-aeac-45cf-8b74-fa616f0d8f52",
      "name": "Set Fecha Tarea",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -102912,
        171824
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Formato incorrecto. Usa YYYY-MM-DD o 0 para saltar.\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f0e8401c-612e-479d-923c-74c4ea160982",
      "name": "Send Fecha Invalida",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        172016
      ],
      "webhookId": "b666ecac-cf59-4587-a0c7-b21ebab2f3b3",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').item.json.chat_id }}",
        "text": "Opcion no valida. Escribe 1, 2, 3 o 9.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5c1def2c-be72-4624-a9b3-6ed37deb08ff",
      "name": "Send Prioridad Invalida",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        171520
      ],
      "webhookId": "4dbc2283-e2e2-42af-8de4-19398aa097c6",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "a9648eff-6ea3-49ab-8dcb-077bb8009256",
      "name": "Get Citas Para Reprogramar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        164320
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (items.length === 0 || !items[0].json.nombre) {\n    return { json: { text: \"No tienes citas pendientes para reprogramar.\\n\\n9. Volver\", list: [] } };\n}\n\nlet text = \"ðŸ“… Selecciona la cita a reprogramar:\\n\\n\";\nconst list = items.map((item, index) => {\n    text += `${index + 1}. ${item.json.fecha} ${item.json.hora} - ${item.json.nombre}\\n`;\n    return { id_cita: item.json.id_cita, detail: `${item.json.fecha} ${item.json.hora} - ${item.json.nombre}` };\n});\n\ntext += \"\\nIngresa el nÃºmero de la cita.\\n9. Cancelar\";\n\nreturn { json: { text, list } };"
      },
      "id": "e185bcc7-f1f4-4826-b407-a17a8247e93b",
      "name": "Format Lista Repro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102912,
        164320
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2a314be9-a9e9-4084-abcc-fe5d6088497f",
      "name": "Send Lista Para Reprogramar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        164320
      ],
      "webhookId": "dc93a917-ef2a-49f6-9889-d1f7aa8e47e7",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_repro_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Repro').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "f54b645f-c694-4ce0-aaa8-af123c6c5bf6",
      "name": "Update Session Repro 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        164320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const msg = $(\"Set Variables\").first().json.mensaje;\nconst list = JSON.parse($(\"Merge Session Data\").first().json.datos_parciales || \"[]\");\nconst index = parseInt(msg) - 1;\nif (isNaN(index) || index < 0 || index >= list.length) {\n    return { json: { valid: false, error: \"SelecciÃ³n no vÃ¡lida. Elige un nÃºmero de la lista.\" } };\n}\n\nreturn { json: { valid: true, id_cita: list[index].id_cita, detail: list[index].detail } };"
      },
      "id": "1b02e1cb-1217-40ae-87a0-7090e7225f58",
      "name": "Logic Seleccion Cita",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        164824
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=Has seleccionado: {{ $json.detail }}\\n\\nPor favor, ingresa la NUEVA FECHA (YYYY-MM-DD):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2aa45ba1-58c0-4a79-90d5-267e355db4ab",
      "name": "Send Solicitar Nueva Fecha",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        164824
      ],
      "webhookId": "00ff6c81-ea97-4186-bce4-a293a0d5629a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_repro_2",
            "paso_actual": "2",
            "datos_parciales": "={{ JSON.stringify($('Logic Seleccion Cita').first().json) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "45ef02a0-7b05-42f5-a1f4-64d6f2b1f268",
      "name": "Update Session Repro 2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        164936
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha": "={{ $json.fecha_cita }}",
            "id_cita": "={{ $json.id_cita }}"
          },
          "matchingColumns": [
            "id_cita"
          ]
        },
        "options": {}
      },
      "id": "a06ea424-21f5-441b-9c2c-f80c4e46a3ef",
      "name": "Update Cita DB",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        167448
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "âœ… Â¡Cita reprogramada con Ã©xito!\\n\\nPresiona 9 para volver al menÃº.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c35e1ce2-73fe-4765-8dc9-ced0889b5bef",
      "name": "Send Confirmacion Repro",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        167448
      ],
      "webhookId": "4fdd0a2f-ca0d-4e63-9fb1-3df545ae627a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const session = $(\"Merge Session Data\").first().json;\nlet reproData = {};\ntry {\n    const dp = session.datos_parciales;\n    reproData = (typeof dp === 'string') ? JSON.parse(dp) : dp;\n} catch (e) {}\n\nreturn { \n  id_cita: reproData.id_cita, \n  fecha_cita: $(\"Set Variables\").first().json.mensaje \n};"
      },
      "id": "7f206425-098c-4ad1-b794-1a5b971096f0",
      "name": "Extract Repro Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        167448
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "48a9f09f-1393-4fca-a072-534c59b14171",
      "name": "Get Citas Para Cancelar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        164512
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (items.length === 0 || !items[0].json.nombre) {\n    return { json: { text: \"No tienes citas pendientes para cancelar.\\n\\n9. Volver\", list: [] } };\n}\n\nlet text = \"âŒ Selecciona la cita a CANCELAR:\\n\\n\";\nconst list = items.map((item, index) => {\n    text += `${index + 1}. ${item.json.fecha} ${item.json.hora} - ${item.json.nombre}\\n`;\n    return { id_cita: item.json.id_cita, detail: `${item.json.fecha} ${item.json.hora} - ${item.json.nombre}` };\n});\n\ntext += \"\\nIngresa el nÃºmero de la cita.\\n9. Cancelar\";\n\nreturn { json: { text, list } };"
      },
      "id": "e1d5f78d-8dab-4114-8a15-341122443e01",
      "name": "Format Lista Cancel",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102912,
        164512
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "48d57a4b-35d6-4638-91fe-0b179f991a1d",
      "name": "Send Lista Para Cancelar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        164512
      ],
      "webhookId": "7e05a80c-f726-44a1-b2fc-940f9b8a1d35",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_cancel_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Cancel').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8b7f6b0f-4065-4890-8ab6-c412f66d68f0",
      "name": "Update Session Cancel 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        164512
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const msg = $(\"Set Variables\").first().json.mensaje;\nconst list = JSON.parse($(\"Merge Session Data\").first().json.datos_parciales || \"[]\");\nconst index = parseInt(msg) - 1;\nif (isNaN(index) || index < 0 || index >= list.length) {\n    return { json: { valid: false, error: \"SelecciÃ³n no vÃ¡lida. Elige un nÃºmero de la lista.\" } };\n}\n\nreturn { json: { valid: true, id_cita: list[index].id_cita, detail: list[index].detail } };"
      },
      "id": "2d069ab2-f73b-45ce-9327-38882026c92c",
      "name": "Logic Seleccion Cancel",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        167736
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f3c36ded-58a6-4df6-93e4-9ae58a3e5208",
      "name": "If Valid Cancel",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        167736
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "estado": "cancelada",
            "id_cita": "={{ $('Logic Seleccion Cancel').first().json.id_cita }}"
          },
          "matchingColumns": [
            "id_cita"
          ]
        },
        "options": {}
      },
      "id": "ab17e45c-2cba-4f5a-8dd5-ca3f546c1d53",
      "name": "Update Cita Cancelada",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        167640
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Cita cancelada: {{ $('Logic Seleccion Cancel').first().json.detail }}\\n\\nPresiona 9 para volver al menÃº.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "997e055d-91fb-4f74-8db1-93697406cd9b",
      "name": "Send Confirmacion Cancel",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        167640
      ],
      "webhookId": "7b6a260a-fcb5-47fa-844e-d79b3004c12a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_menu",
            "paso_actual": "",
            "datos_parciales": "",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "b9cb7f09-8fd2-40b7-a678-4c371114e136",
      "name": "Update Session Back Agenda",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        167640
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Cancel').first().json.error }}\\n\\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "10fec5be-1dfa-49fa-8372-f62f57cbe26d",
      "name": "Send Error Cancel",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        167832
      ],
      "webhookId": "b69f63d7-8247-46a5-a690-8d5438e39ba1",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "65df513c-65d9-4ba5-bf70-84a3d4589f03",
      "name": "Get Citas Para Completar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        164704
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (items.length === 0 || !items[0].json.nombre) {\n    return { json: { text: \"No tienes citas pendientes para completar.\\n\\n9. Volver\", list: [] } };\n}\n\nlet text = \"âœ… Selecciona la cita a marcar como COMPLETADA:\\n\\n\";\nconst list = items.map((item, index) => {\n    text += `${index + 1}. ${item.json.fecha} ${item.json.hora} - ${item.json.nombre}\\n`;\n    return { id_cita: item.json.id_cita, detail: `${item.json.fecha} ${item.json.hora} - ${item.json.nombre}` };\n});\n\ntext += \"\\nIngresa el nÃºmero de la cita.\\n9. Cancelar\";\n\nreturn { json: { text, list } };"
      },
      "id": "c971e732-520a-4d2a-a278-229ad93030c9",
      "name": "Format Lista Completar",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102912,
        164704
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "73d0d202-f30c-49d9-9c22-5b15e315a557",
      "name": "Send Lista Para Completar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        164704
      ],
      "webhookId": "608b7c6b-84a6-45db-afd6-64828fcfa9e5",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_completar_1",
            "paso_actual": "1",
            "datos_parciales": "={{ JSON.stringify($('Format Lista Completar').first().json.list) }}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "0fe3ba88-edbd-45c7-bdeb-4b02132b94e1",
      "name": "Update Session Completar 1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102464,
        164704
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const msg = $(\"Set Variables\").first().json.mensaje;\nconst list = JSON.parse($(\"Merge Session Data\").first().json.datos_parciales || \"[]\");\nconst index = parseInt(msg) - 1;\nif (isNaN(index) || index < 0 || index >= list.length) {\n    return { json: { valid: false, error: \"SelecciÃ³n no vÃ¡lida. Elige un nÃºmero de la lista.\" } };\n}\n\nreturn { json: { valid: true, id_cita: list[index].id_cita, detail: list[index].detail } };"
      },
      "id": "3eb8e351-3457-4965-9d87-88cf800267d6",
      "name": "Logic Seleccion Completar",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103584,
        168120
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "97d0486d-b155-4cf7-a4b0-8da220c7d0a9",
      "name": "If Valid Completar",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        168120
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "estado": "completada",
            "id_cita": "={{ $('Logic Seleccion Completar').first().json.id_cita }}"
          },
          "matchingColumns": [
            "id_cita"
          ]
        },
        "options": {}
      },
      "id": "35f30855-bde1-4f43-b38e-5b37b1a92694",
      "name": "Update Cita Completada",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        168024
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âœ… Cita completada: {{ $('Logic Seleccion Completar').first().json.detail }}\\n\\nPresiona 9 para volver al menÃº.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "267c17b6-0691-4ecd-bafc-d0c18e1150a2",
      "name": "Send Confirmacion Completar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        168024
      ],
      "webhookId": "a30fd60c-860d-411a-9867-728533588e24",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "agenda_menu",
            "paso_actual": "",
            "datos_parciales": "",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8ed2f9fb-bcb8-4706-a7a7-5abd9ae1d250",
      "name": "Update Session Back Agenda Completar",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        168024
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $('Logic Seleccion Completar').first().json.error }}\\n\\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "b9caf1fe-776e-4617-b6e4-9eeeb9d089d9",
      "name": "Send Error Completar",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        168216
      ],
      "webhookId": "6ad91131-2055-40b6-b6f9-8eab906e25af",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "id": "aedbe3ce-c90b-4595-81d9-4ec578988b14",
      "name": "Get Usuario Rol",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        160696
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.rol }}",
              "rightValue": "admin",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a57dc0e2-208f-46f2-ba3d-69fabb06b1bc",
      "name": "If Es Admin",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102912,
        160696
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "â›” No tienes permisos para acceder a esta secciÃ³n.\n\nPresiona 9 para volver al menÃº principal.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "7d070f4f-b9de-46c4-9930-66a20b9e9a66",
      "name": "Send No Permisos",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102688,
        160600
      ],
      "webhookId": "410b5719-86d5-4823-9b70-e2dede35341a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "nombre": "={{ $('Set Variables').first().json.username }}",
            "rol": "usuario",
            "permitido": "true"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "rol",
              "displayName": "rol",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "permitido",
              "displayName": "permitido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "f8d87442-426d-4fca-abc6-3581f5d36e61",
      "name": "Create Usuario",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -104032,
        159552
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "id": "90b2811d-de92-461f-a6ad-cc6ce96fa17c",
      "name": "Check Rol Para Menu",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101792,
        156576
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.rol }}",
              "rightValue": "admin",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "bf9f67b8-62cd-4800-83c3-acecdb632171",
      "name": "If Admin Menu",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -101568,
        156576
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "MENU\n0. Ayuda\n1. Agenda\n2. Tareas\n3. Recordatorios\n4. Habitos\n5. Listas\n6. Reportes",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "89a6f3c4-55d8-4e27-9899-ce0d2ebdc806",
      "name": "Send Menu Usuario",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101344,
        162168
      ],
      "webhookId": "3bb124cd-7b7f-4580-acdc-9300a5f94f4f",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "mi_info"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cambiar_nombre"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "d84744ce-2788-4eec-b86b-419ba9a4482e",
      "name": "Config Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -102016,
        162280
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Esta funciÃ³n estÃ¡ en desarrollo.\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "ffa43b2e-48c1-4df9-b4ca-f41385ec6787",
      "name": "Send Config En Desarrollo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -105376,
        173272
      ],
      "webhookId": "9606e1a7-554b-43ff-a06e-27487e680265",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Set Variables').first().json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "id": "07b7477f-dec0-495b-ae69-6eaeafc47fc4",
      "name": "Get Mi Info",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101792,
        166368
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ 'ðŸ“‹ MI INFORMACIÃ“N\\n\\nðŸ‘¤ Nombre: ' + ($json.nombre || 'No definido') + '\\nðŸ†” Telegram ID: ' + $('Set Variables').first().json.telegram_user + '\\nðŸ‘‘ Rol: ' + ($json.rol || 'usuario') + '\\nâœ… Permitido: ' + ($json.permitido || 'true') + '\\n\\n9. Volver' }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "a948986f-3379-4baa-98b2-6ee11faf59d5",
      "name": "Send Mi Info",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101568,
        166368
      ],
      "webhookId": "ebda586e-1546-487f-939f-4a16ab01d882",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "OpciÃ³n no vÃ¡lida.\n\n1. Mi informaciÃ³n\n2. Cambiar nombre\n\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d65026ff-4e69-4e29-acfa-af0c893adceb",
      "name": "Send Config Invalid",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        166560
      ],
      "webhookId": "436c32d6-3c97-4b02-aa38-969af377b2be",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "âœï¸ Escribe tu nuevo nombre:\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "36892603-cdd2-49d4-81d5-003c9463ccbc",
      "name": "Send Pedir Nombre",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -101792,
        166752
      ],
      "webhookId": "7e6ad35c-bfdd-47c6-8841-1855127493a4",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "config_cambiar_nombre",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "202d5b37-604e-4724-9bb4-bbe639479b06",
      "name": "Update Session Config Nombre",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -101568,
        166752
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ String($('Set Variables').first().json.mensaje).trim() }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "57f874f3-d442-4abc-8799-e88118ffa563",
      "name": "If Cancel Nombre",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103584,
        163144
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1513010529,
          "cachedResultName": "USUARIOS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "nombre": "={{ $('Set Variables').first().json.mensaje }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "7611a36e-d9e0-4674-8beb-3fbf4ea95a89",
      "name": "Update Nombre Usuario",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        163216
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ 'âœ… Nombre actualizado a: ' + $('Set Variables').first().json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "9a97bd05-b408-4aee-a686-c73590ff2771",
      "name": "Send Nombre Actualizado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        163216
      ],
      "webhookId": "357caa1c-f475-44ef-b2ce-c11458ed3b24",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "fecha",
              "lookupValue": "={{ $json.fecha }}"
            },
            {
              "lookupColumn": "hora",
              "lookupValue": "={{ $json.hora }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "pendiente"
            }
          ]
        },
        "options": {}
      },
      "id": "95e7c9d3-3002-4739-a4bd-2580e57f25ec",
      "name": "Check Doble Reserva",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        167216
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.id_cita }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3786e3b3-2525-46d6-8e46-5c46c3e578f5",
      "name": "If No Existe Cita",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -102688,
        167216
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "=âš ï¸ Ya existe una cita para el {{ $('Parse Cita').first().json.fecha }} a las {{ $('Parse Cita').first().json.hora }}.\n\nPor favor elige otra fecha u hora.\n\n9. Volver al menÃº",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "328a6033-b0f3-400d-8195-acd229957aa8",
      "name": "Error Doble Reserva",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102464,
        166496
      ],
      "webhookId": "dba9a990-f9b6-48bd-ab2f-8f1e71d1f46a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "dia"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "semana"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "productividad"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "volver"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "847c666f-eb3b-46f7-adfa-805511b8a309",
      "name": "Reportes Menu Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -103584,
        159424
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q/edit#gid=0"
        },
        "options": {}
      },
      "id": "0990d216-f01d-407d-a0ed-e5459f172bc9",
      "name": "Get Citas Report",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        159256
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "options": {}
      },
      "id": "f4b9e4c0-8cbe-41b8-b1b0-06da76d4f7aa",
      "name": "Get Tareas Report",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        159256
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "options": {}
      },
      "id": "f557e600-2c74-4437-8a7e-fe231d0ba56c",
      "name": "Get Habitos Report",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        159256
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const citas = $('Get Citas Report').all();\nconst tareas = $('Get Tareas Report').all();\nconst habitos = $('Get Habitos Report').all();\nconst user = String($('Set Variables').first().json.telegram_user);\n\n// Usar fecha local en vez de UTC\nconst hoy = new Date();\nconst aÃ±o = hoy.getFullYear();\nconst mes = String(hoy.getMonth() + 1).padStart(2, '0');\nconst dia = String(hoy.getDate()).padStart(2, '0');\nconst hoyStr = aÃ±o + '-' + mes + '-' + dia;\n\n// Citas de hoy\nconst citasHoy = citas.filter(c => c.json.creado_por && String(c.json.creado_por) === user && c.json.fecha === hoyStr && c.json.estado === 'pendiente');\n\n// Tareas pendientes para hoy\nconst tareasHoy = tareas.filter(t => t.json.creado_por && String(t.json.creado_por) === user && t.json.fecha_objetivo === hoyStr && t.json.estado === 'pendiente');\n\n// HÃ¡bitos activos\nconst habitosActivos = habitos.filter(h => h.json.creado_por && String(h.json.creado_por) === user && h.json.estado === 'activo');\n\nlet msg = 'ðŸ“… RESUMEN DEL DÃA\\n' + hoyStr + '\\n\\n';\n\nmsg += 'ðŸ“‹ CITAS HOY: ' + citasHoy.length + '\\n';\nif (citasHoy.length > 0) {\n  citasHoy.forEach(c => { msg += '  â€¢ ' + c.json.hora + ' - ' + c.json.nombre + '\\n'; });\n} else {\n  msg += '  Sin citas programadas\\n';\n}\n\nmsg += '\\nâœ… TAREAS PENDIENTES: ' + tareasHoy.length + '\\n';\nif (tareasHoy.length > 0) {\n  tareasHoy.forEach(t => { msg += '  â€¢ ' + t.json.descripcion + '\\n'; });\n} else {\n  msg += '  Sin tareas para hoy\\n';\n}\n\nmsg += '\\nðŸŽ¯ HÃBITOS: ' + habitosActivos.length + '\\n';\nif (habitosActivos.length > 0) {\n  habitosActivos.forEach(h => { msg += '  â€¢ ' + h.json.nombre + ' (' + h.json.hora_recordatorio + ')\\n'; });\n} else {\n  msg += '  Sin hÃ¡bitos activos\\n';\n}\n\nmsg += '\\n9. Volver';\nreturn [{json: {mensaje: msg}}];"
      },
      "id": "c9762c9c-b3ca-427f-8f19-b3e5a88cab3c",
      "name": "Format Report Dia",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102688,
        159256
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "23349da7-8382-4bb7-91d1-f75abf6c0b67",
      "name": "Send Report Dia",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102464,
        159256
      ],
      "webhookId": "b308342a-934c-452e-8aff-a32667cd872b",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 0,
          "cachedResultName": "CITAS"
        },
        "options": {}
      },
      "id": "4674024d-8c20-40de-a5e6-02d7abaa2760",
      "name": "Get Citas Semanal",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        159448
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "options": {}
      },
      "id": "cda0668c-c6b1-45d2-9786-911d90817260",
      "name": "Get Tareas Semanal",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103136,
        159448
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 563773723,
          "cachedResultName": "HABITOS"
        },
        "options": {}
      },
      "id": "75e03fc1-0abc-40af-a841-9e8a88c02e3d",
      "name": "Get Habitos Semanal",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102912,
        159448
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const citas = $('Get Citas Semanal').all();\nconst tareas = $('Get Tareas Semanal').all();\nconst habitos = $('Get Habitos Semanal').all();\nconst user = String($('Set Variables').first().json.telegram_user);\n\n// FunciÃ³n para formatear fecha local\nfunction formatDate(d) {\n  return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');\n}\n\nconst hoy = new Date();\nconst inicioSemana = new Date(hoy);\ninicioSemana.setDate(hoy.getDate() - hoy.getDay());\nconst finSemana = new Date(inicioSemana);\nfinSemana.setDate(inicioSemana.getDate() + 6);\n\nconst inicioStr = formatDate(inicioSemana);\nconst finStr = formatDate(finSemana);\n\n// Citas de la semana\nconst citasSemana = citas.filter(c => {\n  if (!c.json.creado_por || String(c.json.creado_por) !== user) return false;\n  return c.json.fecha >= inicioStr && c.json.fecha <= finStr;\n});\n\n// Tareas de la semana\nconst tareasUser = tareas.filter(t => t.json.creado_por && String(t.json.creado_por) === user);\nconst tareasCompletadas = tareasUser.filter(t => t.json.estado === 'completada');\nconst tareasPendientes = tareasUser.filter(t => t.json.estado === 'pendiente');\n\n// HÃ¡bitos activos\nconst habitosActivos = habitos.filter(h => h.json.creado_por && String(h.json.creado_por) === user && h.json.estado === 'activo');\n\nlet msg = 'ðŸ“Š RESUMEN SEMANAL\\n' + inicioStr + ' al ' + finStr + '\\n\\n';\n\nmsg += 'ðŸ“‹ CITAS ESTA SEMANA: ' + citasSemana.length + '\\n';\nif (citasSemana.length > 0) {\n  citasSemana.slice(0, 5).forEach(c => { msg += '  â€¢ ' + c.json.fecha + ' ' + c.json.hora + ' - ' + c.json.nombre + '\\n'; });\n  if (citasSemana.length > 5) msg += '  ... y ' + (citasSemana.length - 5) + ' mÃ¡s\\n';\n}\n\nmsg += '\\nâœ… TAREAS:\\n';\nmsg += '  Completadas: ' + tareasCompletadas.length + '\\n';\nmsg += '  Pendientes: ' + tareasPendientes.length + '\\n';\n\nmsg += '\\nðŸŽ¯ HÃBITOS ACTIVOS: ' + habitosActivos.length + '\\n';\nhabitosActivos.forEach(h => { msg += '  â€¢ ' + h.json.nombre + '\\n'; });\n\nmsg += '\\n9. Volver';\nreturn [{json: {mensaje: msg}}];"
      },
      "id": "479da28b-8977-4a38-8c94-3e8b9d07a3ec",
      "name": "Format Report Semanal",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -102688,
        159448
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5e518806-d654-4e5d-8644-e2768e2706c0",
      "name": "Send Report Semanal",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102464,
        159448
      ],
      "webhookId": "4b024cd0-0d91-4e20-a87a-aa6f193cb08a",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 37820303,
          "cachedResultName": "TAREAS"
        },
        "options": {}
      },
      "id": "69224efb-4a25-4b64-93d9-d3266eee92a5",
      "name": "Get Tareas Productividad",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -103360,
        159640
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const tareas = $('Get Tareas Productividad').all();\nconst user = String($('Set Variables').first().json.telegram_user);\n\nconst tareasUser = tareas.filter(t => t.json.creado_por && String(t.json.creado_por) === user);\nconst completadas = tareasUser.filter(t => t.json.estado === 'completada');\nconst pendientes = tareasUser.filter(t => t.json.estado === 'pendiente');\nconst eliminadas = tareasUser.filter(t => t.json.estado === 'eliminada');\n\nconst total = tareasUser.length;\nconst porcentaje = total > 0 ? Math.round((completadas.length / total) * 100) : 0;\n\nlet msg = 'ðŸ“ˆ PRODUCTIVIDAD\\n\\n';\nmsg += 'ðŸ“Š ESTADÃSTICAS DE TAREAS:\\n\\n';\nmsg += '  Total creadas: ' + total + '\\n';\nmsg += '  âœ… Completadas: ' + completadas.length + '\\n';\nmsg += '  â³ Pendientes: ' + pendientes.length + '\\n';\nmsg += '  ðŸ—‘ï¸ Eliminadas: ' + eliminadas.length + '\\n\\n';\nmsg += '  ðŸ“ˆ Tasa de completado: ' + porcentaje + '%\\n';\n\n// Barra de progreso visual\nconst barraLlena = Math.round(porcentaje / 10);\nconst barraVacia = 10 - barraLlena;\nmsg += '  [' + 'â–ˆ'.repeat(barraLlena) + 'â–‘'.repeat(barraVacia) + ']\\n';\n\nmsg += '\\n9. Volver';\nreturn [{json: {mensaje: msg}}];"
      },
      "id": "d89d29ad-3d38-4ede-a3ce-a376c3c8090e",
      "name": "Format Report Productividad",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -103136,
        159640
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "={{ $json.mensaje }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "921081c9-8654-4163-b83d-e95245efe11b",
      "name": "Send Report Productividad",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -102912,
        159640
      ],
      "webhookId": "6d40deba-ec97-4a74-b388-9cd794adf001",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "OpciÃ³n no vÃ¡lida.\n\nðŸ“Š REPORTES\n\n1. Resumen del dÃ­a\n2. Resumen semanal\n3. Productividad\n9. Volver",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "7f5e5f69-1e19-405a-9610-deb235af8fb8",
      "name": "Send Invalid Reportes",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103360,
        159832
      ],
      "webhookId": "72a7347f-dd6b-45f6-8251-0c7a9dd08990",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "reporte_dia",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "76aa27fc-0a78-4844-9b33-b990e23cd912",
      "name": "Update Session Report Dia",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102240,
        159256
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "reporte_semanal",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "e66372ec-f5e4-4416-a0e4-c07f48c18155",
      "name": "Update Session Report Semanal",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102240,
        159448
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "196K9mqVfhN8JUFpZfrvXQftcrTnQxOCqiUU_aB6I52Q"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 319260215,
          "cachedResultName": "SESSIONS"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Set Variables').first().json.telegram_user }}",
            "pantalla_actual": "reporte_productividad",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $('Set Variables').first().json.timestamp }}"
          },
          "matchingColumns": [
            "telegram_user"
          ]
        },
        "options": {}
      },
      "id": "8c037fdc-d177-4814-98e8-2b93f310948e",
      "name": "Update Session Report Productividad",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -102688,
        159640
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "fZ7jIZOfX6ts7GKS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Set Variables').first().json.chat_id }}",
        "text": "Presiona 9 para volver al menÃº de reportes.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "1d14100c-e467-4cd6-b739-7f61814e25af",
      "name": "Send Invalid Reporte",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -103136,
        162928
      ],
      "webhookId": "9f47200a-9ef6-4caf-b18e-d4509668bc83",
      "credentials": {
        "telegramApi": {
          "id": "zSRrHWxaB0iogEXa",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "leftValue": "={{ $('Set Variables').first().json.mensaje }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9470ff4d-1cca-4fc6-a702-ef13745835c5",
      "name": "Reporte Volver Router",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -103360,
        162880
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Set Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variables": {
      "main": [
        [
          {
            "node": "Get Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Session": {
      "main": [
        [
          {
            "node": "Session Exists?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Session Exists?": {
      "main": [
        [
          {
            "node": "Merge Session Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set New User Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Session Data": {
      "main": [
        [
          {
            "node": "Log Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set New User Data": {
      "main": [
        [
          {
            "node": "Create New Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create New Session": {
      "main": [
        [
          {
            "node": "Log Interaction",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Interaction": {
      "main": [
        [
          {
            "node": "Router Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Bienvenida": {
      "main": [
        [
          {
            "node": "Prepare Update Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Update Data": {
      "main": [
        [
          {
            "node": "Update Session to Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router Principal": {
      "main": [
        [
          {
            "node": "Send Bienvenida",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Bienvenida",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menu Principal Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda Wizard Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tareas Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tarea Wizard Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habitos Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Listas Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Option",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reportes Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Config Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Admin Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ayuda Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Repro Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Cancel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Completar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Consultar Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ver Pendientes Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ver Completadas Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Completar Tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tarea Completada Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Eliminar Tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tarea Eliminada Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ver Habitos Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Eliminar Habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habito Eliminado Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habito Crear Paso 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habito Crear Paso 3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Guardar Habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Recordatorio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Guardar Hora Recordatorio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Lista Crear Nombre",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Lista Agregar Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Items Lista Menu Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Agregar Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Completar Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Logic Seleccion Eliminar Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reporte Volver Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reporte Volver Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reporte Volver Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reporte Volver Router": {
      "main": [
        [
          {
            "node": "Send Reportes Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Reporte",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consultar Router": {
      "main": [
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Consultar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Ayuda": {
      "main": [
        [
          {
            "node": "Update to Ayuda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ayuda Menu Router": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Option",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal Router": {
      "main": [
        [
          {
            "node": "Send Ayuda",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Habitos Recordatorio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Listas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Reportes Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Config Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Usuario Rol",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Option",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Agenda Menu": {
      "main": [
        [
          {
            "node": "Update to Agenda Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tareas Menu": {
      "main": [
        [
          {
            "node": "Update to Tareas Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habitos Menu": {
      "main": [
        [
          {
            "node": "Update to Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos Menu Router": {
      "main": [
        [
          {
            "node": "Send Habito Paso 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Habitos Activos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Habitos Para Eliminar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habito Paso 1": {
      "main": [
        [
          {
            "node": "Update Habito Paso 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Habitos Activos": {
      "main": [
        [
          {
            "node": "Format Habitos Activos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Habitos Activos": {
      "main": [
        [
          {
            "node": "Send Habitos Activos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habitos Activos": {
      "main": [
        [
          {
            "node": "Update Session Ver Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ver Habitos Router": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Ver Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Habitos Para Eliminar": {
      "main": [
        [
          {
            "node": "Format Lista Eliminar Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Eliminar Habitos": {
      "main": [
        [
          {
            "node": "Send Lista Eliminar Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Eliminar Habitos": {
      "main": [
        [
          {
            "node": "Update Session Eliminar Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Eliminar Habito": {
      "main": [
        [
          {
            "node": "If Valid Eliminar Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Eliminar Habito": {
      "main": [
        [
          {
            "node": "Update Habito Eliminado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Eliminar Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Habito Eliminado": {
      "main": [
        [
          {
            "node": "Send Habito Eliminado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habito Eliminado": {
      "main": [
        [
          {
            "node": "Update Session Habito Eliminado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Eliminar Habito": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Eliminar Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habito Eliminado Router": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Habito Eliminado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habito Crear Paso 2": {
      "main": [
        [
          {
            "node": "If Cancel Crear Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Crear Habito": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Habito Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habito Paso 2": {
      "main": [
        [
          {
            "node": "Update Habito Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habito Crear Paso 3": {
      "main": [
        [
          {
            "node": "If Cancel Crear Habito 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Crear Habito 2": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Habito Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Habito Paso 3": {
      "main": [
        [
          {
            "node": "Update Habito Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Habito": {
      "main": [
        [
          {
            "node": "If Cancel Crear Habito 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Crear Habito 3": {
      "main": [
        [
          {
            "node": "Send Habitos Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Habito": {
      "main": [
        [
          {
            "node": "Send Habito Creado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Habitos Recordatorio": {
      "main": [
        [
          {
            "node": "Format Lista Recordatorios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Recordatorios": {
      "main": [
        [
          {
            "node": "Send Lista Recordatorios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Recordatorios": {
      "main": [
        [
          {
            "node": "Update Session Recordatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Recordatorio": {
      "main": [
        [
          {
            "node": "If Valid Recordatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Recordatorio": {
      "main": [
        [
          {
            "node": "Send Pedir Hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Recordatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Pedir Hora": {
      "main": [
        [
          {
            "node": "Update Session Recordatorio 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Recordatorio": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Recordatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Hora Recordatorio": {
      "main": [
        [
          {
            "node": "If Cancel Guardar Hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Guardar Hora": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Hora Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Hora Habito": {
      "main": [
        [
          {
            "node": "Send Hora Actualizada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Hora Actualizada": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Listas Menu": {
      "main": [
        [
          {
            "node": "Update to Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listas Menu Router": {
      "main": [
        [
          {
            "node": "Send Lista Paso 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Listas Usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Paso 1": {
      "main": [
        [
          {
            "node": "Update Lista Paso 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista Crear Nombre": {
      "main": [
        [
          {
            "node": "If Cancel Lista 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Lista 1": {
      "main": [
        [
          {
            "node": "Send Listas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Lista": {
      "main": [
        [
          {
            "node": "Send Lista Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Paso 2": {
      "main": [
        [
          {
            "node": "Update Lista Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista Agregar Item": {
      "main": [
        [
          {
            "node": "Lista Action Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista Action Router": {
      "main": [
        [
          {
            "node": "Insert Item Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Lista Creada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Listas Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Item Lista": {
      "main": [
        [
          {
            "node": "Send Item Agregado Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Item Agregado Loop": {
      "main": [
        [
          {
            "node": "Update Session Item Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Creada": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Listas Usuario": {
      "main": [
        [
          {
            "node": "Format Listas Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Listas Usuario": {
      "main": [
        [
          {
            "node": "Send Listas Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Listas Usuario": {
      "main": [
        [
          {
            "node": "Update Session Ver Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Lista": {
      "main": [
        [
          {
            "node": "If Valid Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Lista": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Ver Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Ver Listas": {
      "main": [
        [
          {
            "node": "Send Listas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Ver Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Items Lista": {
      "main": [
        [
          {
            "node": "Format Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Items Lista": {
      "main": [
        [
          {
            "node": "Send Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Items Lista": {
      "main": [
        [
          {
            "node": "Update Session Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Items Lista Menu Router": {
      "main": [
        [
          {
            "node": "Send Agregar Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Items Completar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Items Eliminar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Listas Usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Agregar Item": {
      "main": [
        [
          {
            "node": "Update Session Agregar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Agregar Item": {
      "main": [
        [
          {
            "node": "If Cancel Agregar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Agregar Item": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Item": {
      "main": [
        [
          {
            "node": "Send Item Agregado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Item Agregado": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Items Completar": {
      "main": [
        [
          {
            "node": "Send Items Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Items Completar": {
      "main": [
        [
          {
            "node": "Update Session Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Completar Item": {
      "main": [
        [
          {
            "node": "If Valid Completar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Completar Item": {
      "main": [
        [
          {
            "node": "Update Item Completado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Completar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Item Completado": {
      "main": [
        [
          {
            "node": "Send Item Completado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Item Completado": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Completar Item": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Completar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Items Eliminar": {
      "main": [
        [
          {
            "node": "Send Items Eliminar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Items Eliminar": {
      "main": [
        [
          {
            "node": "Update Session Eliminar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Eliminar Item": {
      "main": [
        [
          {
            "node": "If Valid Eliminar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Eliminar Item": {
      "main": [
        [
          {
            "node": "Update Item Eliminado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Eliminar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Item Eliminado": {
      "main": [
        [
          {
            "node": "Send Item Eliminado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Item Eliminado": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Eliminar Item": {
      "main": [
        [
          {
            "node": "Get Items Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Eliminar Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reportes Menu": {
      "main": [
        [
          {
            "node": "Update to Reportes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reportes Menu Router": {
      "main": [
        [
          {
            "node": "Get Citas Report",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Citas Semanal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tareas Productividad",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Reportes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Report": {
      "main": [
        [
          {
            "node": "Get Tareas Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Report": {
      "main": [
        [
          {
            "node": "Get Habitos Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Habitos Report": {
      "main": [
        [
          {
            "node": "Format Report Dia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report Dia": {
      "main": [
        [
          {
            "node": "Send Report Dia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Report Dia": {
      "main": [
        [
          {
            "node": "Update Session Report Dia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Semanal": {
      "main": [
        [
          {
            "node": "Get Tareas Semanal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Semanal": {
      "main": [
        [
          {
            "node": "Get Habitos Semanal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Habitos Semanal": {
      "main": [
        [
          {
            "node": "Format Report Semanal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report Semanal": {
      "main": [
        [
          {
            "node": "Send Report Semanal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Report Semanal": {
      "main": [
        [
          {
            "node": "Update Session Report Semanal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Productividad": {
      "main": [
        [
          {
            "node": "Format Report Productividad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report Productividad": {
      "main": [
        [
          {
            "node": "Send Report Productividad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Report Productividad": {
      "main": [
        [
          {
            "node": "Update Session Report Productividad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Config Menu": {
      "main": [
        [
          {
            "node": "Update to Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Admin Menu": {
      "main": [
        [
          {
            "node": "Update to Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Menu Principal": {
      "main": [
        [
          {
            "node": "Update Volver Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda Menu Router": {
      "main": [
        [
          {
            "node": "Send Agenda Paso 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Citas Usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Citas Para Reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Citas Para Cancelar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Citas Para Completar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Agenda Paso 1": {
      "main": [
        [
          {
            "node": "Update Agenda Paso 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Usuario": {
      "main": [
        [
          {
            "node": "Format Citas Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Citas Lista": {
      "main": [
        [
          {
            "node": "Send Consultar Citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Consultar Citas": {
      "main": [
        [
          {
            "node": "Update Session Consultar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda Wizard Router": {
      "main": [
        [
          {
            "node": "Cancelar?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelar 2?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelar 3?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelar 4?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Canal Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Confirmar Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar?": {
      "main": [
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Fecha": {
      "main": [
        [
          {
            "node": "If Fecha Valida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Fecha Valida": {
      "main": [
        [
          {
            "node": "Set Fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Fecha": {
      "main": [
        [
          {
            "node": "Update Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Paso 2": {
      "main": [
        [
          {
            "node": "Send Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar 2?": {
      "main": [
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Hora": {
      "main": [
        [
          {
            "node": "Set Hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Hora": {
      "main": [
        [
          {
            "node": "Update Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Paso 3": {
      "main": [
        [
          {
            "node": "Send Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar 3?": {
      "main": [
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Nombre": {
      "main": [
        [
          {
            "node": "Update Paso 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Paso 4": {
      "main": [
        [
          {
            "node": "Send Paso 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar 4?": {
      "main": [
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Motivo": {
      "main": [
        [
          {
            "node": "Update Paso 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Paso 5": {
      "main": [
        [
          {
            "node": "Send Paso 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Canal Router": {
      "main": [
        [
          {
            "node": "Set Presencial",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Virtual",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Llamada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Presencial": {
      "main": [
        [
          {
            "node": "Update Paso 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Virtual": {
      "main": [
        [
          {
            "node": "Update Paso 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Llamada": {
      "main": [
        [
          {
            "node": "Update Paso 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Paso 6": {
      "main": [
        [
          {
            "node": "Send Paso 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirmar Router": {
      "main": [
        [
          {
            "node": "Parse Cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Agenda Paso 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Agenda Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Cita": {
      "main": [
        [
          {
            "node": "Check Doble Reserva",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Doble Reserva": {
      "main": [
        [
          {
            "node": "If No Existe Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If No Existe Cita": {
      "main": [
        [
          {
            "node": "Guardar Cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Doble Reserva",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Cita": {
      "main": [
        [
          {
            "node": "Update After Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update After Cita": {
      "main": [
        [
          {
            "node": "Cita OK",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cita OK": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Volver Router": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Option",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas Menu Router": {
      "main": [
        [
          {
            "node": "Send Tarea Paso 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tareas Pendientes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tareas Completadas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tareas Para Completar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tareas Para Eliminar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tarea Paso 1": {
      "main": [
        [
          {
            "node": "Update Tarea Paso 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Pendientes": {
      "main": [
        [
          {
            "node": "Format Tareas Pendientes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Tareas Pendientes": {
      "main": [
        [
          {
            "node": "Send Tareas Pendientes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tareas Pendientes": {
      "main": [
        [
          {
            "node": "Update Session Ver Pendientes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ver Pendientes Router": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Ver Pendientes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Completadas": {
      "main": [
        [
          {
            "node": "Format Tareas Completadas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Tareas Completadas": {
      "main": [
        [
          {
            "node": "Send Tareas Completadas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tareas Completadas": {
      "main": [
        [
          {
            "node": "Update Session Ver Completadas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ver Completadas Router": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Ver Completadas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Para Completar": {
      "main": [
        [
          {
            "node": "Format Lista Completar Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Completar Tareas": {
      "main": [
        [
          {
            "node": "Send Lista Completar Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Completar Tareas": {
      "main": [
        [
          {
            "node": "Update Session Completar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Completar Tarea": {
      "main": [
        [
          {
            "node": "If Valid Completar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Completar Tarea": {
      "main": [
        [
          {
            "node": "Update Tarea Completada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Completar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Tarea Completada": {
      "main": [
        [
          {
            "node": "Send Tarea Completada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tarea Completada": {
      "main": [
        [
          {
            "node": "Update Session Tarea Completada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Completar Tarea": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Completar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tarea Completada Router": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Tarea Completada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tareas Para Eliminar": {
      "main": [
        [
          {
            "node": "Format Lista Eliminar Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Eliminar Tareas": {
      "main": [
        [
          {
            "node": "Send Lista Eliminar Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Eliminar Tareas": {
      "main": [
        [
          {
            "node": "Update Session Eliminar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Eliminar Tarea": {
      "main": [
        [
          {
            "node": "If Valid Eliminar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Eliminar Tarea": {
      "main": [
        [
          {
            "node": "Delete Tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Cancel Eliminar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Tarea": {
      "main": [
        [
          {
            "node": "Send Tarea Eliminada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Tarea Eliminada": {
      "main": [
        [
          {
            "node": "Update Session Tarea Eliminada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Eliminar Tarea": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Eliminar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tarea Eliminada Router": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Tarea Eliminada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tarea Wizard Router": {
      "main": [
        [
          {
            "node": "Cancelar Tarea?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelar Tarea 2?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelar Tarea 3?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Invalid Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar Tarea?": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Titulo Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Titulo Tarea": {
      "main": [
        [
          {
            "node": "Update Tarea Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Tarea Paso 2": {
      "main": [
        [
          {
            "node": "Send Tarea Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar Tarea 2?": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prioridad Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prioridad Router": {
      "main": [
        [
          {
            "node": "Set Prioridad Alta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Prioridad Media",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Prioridad Baja",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Prioridad Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Prioridad Alta": {
      "main": [
        [
          {
            "node": "Update Tarea Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Prioridad Media": {
      "main": [
        [
          {
            "node": "Update Tarea Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Prioridad Baja": {
      "main": [
        [
          {
            "node": "Update Tarea Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Tarea Paso 3": {
      "main": [
        [
          {
            "node": "Send Tarea Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar Tarea 3?": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Valida?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fecha Valida?": {
      "main": [
        [
          {
            "node": "Set Fecha Tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Fecha Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Fecha Tarea": {
      "main": [
        [
          {
            "node": "Parse Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Tarea": {
      "main": [
        [
          {
            "node": "Guardar Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Tarea": {
      "main": [
        [
          {
            "node": "Tarea OK",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tarea OK": {
      "main": [
        [
          {
            "node": "Update After Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update After Tarea": {
      "main": [
        [
          {
            "node": "Send Tareas Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Para Reprogramar": {
      "main": [
        [
          {
            "node": "Format Lista Repro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Repro": {
      "main": [
        [
          {
            "node": "Send Lista Para Reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Para Reprogramar": {
      "main": [
        [
          {
            "node": "Update Session Repro 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Cita": {
      "main": [
        [
          {
            "node": "Send Solicitar Nueva Fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Solicitar Nueva Fecha": {
      "main": [
        [
          {
            "node": "Update Session Repro 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Repro Data": {
      "main": [
        [
          {
            "node": "Update Cita DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Cita DB": {
      "main": [
        [
          {
            "node": "Send Confirmacion Repro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Confirmacion Repro": {
      "main": [
        [
          {
            "node": "Update to Agenda Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Para Cancelar": {
      "main": [
        [
          {
            "node": "Format Lista Cancel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Cancel": {
      "main": [
        [
          {
            "node": "Send Lista Para Cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Para Cancelar": {
      "main": [
        [
          {
            "node": "Update Session Cancel 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Cancel": {
      "main": [
        [
          {
            "node": "If Valid Cancel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Cancel": {
      "main": [
        [
          {
            "node": "Update Cita Cancelada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Cancel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Cita Cancelada": {
      "main": [
        [
          {
            "node": "Send Confirmacion Cancel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Confirmacion Cancel": {
      "main": [
        [
          {
            "node": "Update Session Back Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Citas Para Completar": {
      "main": [
        [
          {
            "node": "Format Lista Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Lista Completar": {
      "main": [
        [
          {
            "node": "Send Lista Para Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Lista Para Completar": {
      "main": [
        [
          {
            "node": "Update Session Completar 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logic Seleccion Completar": {
      "main": [
        [
          {
            "node": "If Valid Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Valid Completar": {
      "main": [
        [
          {
            "node": "Update Cita Completada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Cita Completada": {
      "main": [
        [
          {
            "node": "Send Confirmacion Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Confirmacion Completar": {
      "main": [
        [
          {
            "node": "Update Session Back Agenda Completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Usuario Rol": {
      "main": [
        [
          {
            "node": "If Es Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Es Admin": {
      "main": [
        [
          {
            "node": "Send Admin Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send No Permisos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Rol Para Menu": {
      "main": [
        [
          {
            "node": "If Admin Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Admin Menu": {
      "main": [
        [
          {
            "node": "Send Menu Principal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Menu Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Menu Usuario": {
      "main": [
        [
          {
            "node": "Update Volver Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config Menu Router": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Mi Info",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Pedir Nombre",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Config Invalid",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Pedir Nombre": {
      "main": [
        [
          {
            "node": "Update Session Config Nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Cancel Nombre": {
      "main": [
        [
          {
            "node": "Send Config Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Nombre Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Nombre Usuario": {
      "main": [
        [
          {
            "node": "Send Nombre Actualizado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Nombre Actualizado": {
      "main": [
        [
          {
            "node": "Send Config Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Mi Info": {
      "main": [
        [
          {
            "node": "Send Mi Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Admin Menu Router": {
      "main": [
        [
          {
            "node": "Check Rol Para Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get All Usuarios",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Stats Citas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Admin Invalid",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Usuarios": {
      "main": [
        [
          {
            "node": "Format Usuarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Usuarios": {
      "main": [
        [
          {
            "node": "Send Usuarios List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stats Citas": {
      "main": [
        [
          {
            "node": "Get Stats Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stats Tareas": {
      "main": [
        [
          {
            "node": "Get Stats Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stats Habitos": {
      "main": [
        [
          {
            "node": "Get Stats Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stats Listas": {
      "main": [
        [
          {
            "node": "Format Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Stats": {
      "main": [
        [
          {
            "node": "Send Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "6700ae42-d9a1-45f9-88f2-1c23b9b20da8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f9c95d1c6c5a88f42f809307f78f6486a001bde66068e0e4a3dd1b4652866230"
  },
  "id": "jJ7XgGYsF7CmC2HtBzYm2",
  "tags": []
}